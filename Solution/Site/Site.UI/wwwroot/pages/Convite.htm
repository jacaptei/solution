<template>
    <div class="container">
        <div style="text-align: center; width: 100%;">
            <div style="text-align:center;width:100%;">
                <p class="title">
                    Crie Sua Finalize o seu Registro e faça parte do Time {{usuario}}
                </p>
            </div>

            <div class="invite-form" id="form" v-if="view == 'form' ">
                <el-col :md="24">
                    <el-row :gutter="20">
                        <el-col :xs="24" :sm="24" :md="24" :lg="24" class="input-form">
                            <div>
                                <span></span><span></span>
                                <div>NOME COMPLETO</div>
                            </div>
                            <el-input @keyup.enter="Send()" v-model="$root.usuario.nome" placeholder="" maxlength="80" input-style="text-transform:uppercase;"></el-input>
                        </el-col>
                        <el-col :xs="24" :sm="24" :md="24" :lg="24" class="input-form">
                            <div>CPF<span></span></div>
                            <el-input @keyup.enter="Send()" v-model="$root.usuario.cpf" maxlength="22" v-maska data-maska="###.###.###-##" @blur="CheckDoc" ref="documento"></el-input>
                        </el-col>
                        <el-col :xs="24" :sm="24" :md="24" :lg="24" class="input-form">
                            <div>E-MAIL <span></span></div>
                            <el-input @keyup.enter="Send()" v-model="$root.usuario.email" placeholder="" maxlength="80" input-style="text-transform:lowercase;"></el-input>
                        </el-col>
                        <el-col :xs="24" :sm="24" :md="24" :lg="24" class="input-form">
                            <div>TELEFONE <span></span></div>
                            <el-input @keyup.enter="Send()" v-model="$root.usuario.telefone" placeholder="(11) 11111-1111" maxlength="40" input-style="text-transform:lowercase;" v-maska data-maska="(##) #####-#### ********************"></el-input>
                        </el-col>
                        <el-col :xs="24" class="input-form">
                            <div>DATA DE NASCIMENTO</div>
                            <div class="birth-date">
                                <el-select v-model="DiaNascimento"
                                           filterable
                                           placeholder="DIA"
                                           size="medium">
                                    <el-option v-for="item in $sdata.forms.days"
                                               :key="item.value"
                                               :label="item.label"
                                               :value="item.value"></el-option>
                                </el-select>

                                <el-select v-model="MesNascimento"
                                           filterable
                                           placeholder="MÊS"
                                           size="medium">
                                    <el-option v-for="item in $sdata.forms.months"
                                               :key="item.value"
                                               :label="item.label"
                                               :value="item.value"></el-option>
                                </el-select>

                                <el-select v-model="AnoNascimento"
                                           filterable
                                           placeholder="ANO"
                                           size="medium">
                                    <el-option v-for="item in $sdata.forms.years"
                                               :key="item.value"
                                               :label="item.label"
                                               :value="item.value"></el-option>
                                </el-select>
                            </div>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24" :lg="24" v-if="$root.usuario.tipoPessoa == 'PF'" class="input-form">
                            <div>SEXO <span></span></div>
                            <el-select filterable v-model="$root.usuario.sexo" class="m-4" placeholder="Selecionar" size="large" style="width:100%">
                                <el-option v-for="item in opcoes.sexos"
                                           :key="item.id"
                                           :label="item.label"
                                           :value="item.value"></el-option>
                            </el-select>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="12" :lg="12" class="input-form">
                            <div>
                                <span></span><span></span>
                                <div>CRECI</div>
                            </div>
                            <el-input @keyup.enter="Send()" v-model="$root.usuario.creci" placeholder="" maxlength="22"></el-input>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24" :lg="12" class="input-form">
                            <div><p>CRECI - ESTADO</p><span></span></div>
                            <div style="height:40px" v-if="carregandoEstadosCreci">
                                <c-loading size="30px" style="padding-left:5px"></c-loading>
                            </div>
                            <el-select v-else filterable v-model="$root.usuario.creciEstado" class="m-4" placeholder="Selecionar" size="large" style="width:100%" @change="(item)=>{enableFilterButton = true;}">
                                <el-option v-for="item in opcoes.estadosCreci"
                                           :key="item.id"
                                           :label="item.label"
                                           :value="item.uf"></el-option>
                            </el-select>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24" :lg="24" v-if="$root.usuario.idTipo != 2" class="input-form">
                            <div>SENHA <span style="color:#808080">&nbsp;pelo menos 4 caracteres</span></div>
                            <el-input @keyup.enter="Send()" v-model="$root.usuario.senha" type="password" placeholder="" maxlength="20" show-password></el-input>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24" :lg="24" v-if="$root.usuario.idTipo != 2" class="input-form">
                            <div>CONFIRMAR SENHA <span style="color:#808080">&nbsp;repetir senha</span></div>
                            <el-input @keyup.enter="Send()" v-model="senhaConfirma" type="password" placeholder="" maxlength="20" show-password></el-input>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :md="24" style="margin:10px">
                            <div>
                                <el-checkbox v-model="$root.usuario.aceitouTermos">aceito os termos e condições de uso <a href="files/JaCaptei_Termos_de_Uso.pdf" target="_blank" style="font-weight:800;color:var(--s-accent-color)"> <i class="fa fa-up-right-from-square" style="padding-left:10px;padding-right:4px;font-size:14px;color:var(--s-accent-color)"></i> ver termos</a></el-checkbox>
                                <br />
                                <el-checkbox v-model="$root.usuario.aceitouPoliticaPrivacidade">aceito a política de privacidade dos dados <a href="files/JaCaptei_Politica_Privacidade.pdf" target="_blank" style="font-weight:800;color:var(--s-accent-color)"> <i class="fa fa-up-right-from-square" style="padding-left:10px;padding-right:4px;font-size:14px;color:var(--s-accent-color)"></i> ver política</a></el-checkbox>
                            </div>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :md="24" style="margin-top:0px">
                            <q-btn label="Enviar" color="secondary" @click="Send()" style="width:100%;height:40px"></q-btn>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20" style="margin-top:20px">
                        <el-col :md="12">
                            Já tem cadastro? faça o   <el-button type="primary" link @click="$root.Login()">LOGIN</el-button>
                        </el-col>
                        <el-col :md="12" style="text-align:end;padding-right:10px">
                            Exceto <i>Complemento</i>, todos os campos são necessários.
                        </el-col>
                    </el-row>
                </el-col>
            </div>

            <div v-else-if="view=='sending'" style="min-height:374px">
                <br /><br />
                <div class="title" style="color:#fff"><b>Enviando</b></div>
                <br /><br />
                <c-loading size="3em" color="#fff"></c-loading>
            </div>

            <div v-else-if="view=='alert'">
                <br /><br />
                <div class="title" style="color:var(--s-color-yellow)"><b><i class="fa-solid fa-triangle-exclamation"></i> Atenção</b></div>
                <br /><br />
                <br /><span v-html="messageAlert"></span>
                <br /><br />
                <q-btn color="white" text-color="indigo-10" label="VOLTAR" @click="ShowView(viewLast)" style="width:160px;" id="btn_voltar_5"></q-btn>
            </div>

            <div v-else-if="view=='success'" style="min-height:374px">
                <div>
                    <br />
                    <br />
                    <div class="title" style="color:#fff"><b><i class="fa fa-circle-check" style="color:#fff"></i> Sucesso</b></div>
                    <br />
                    <span style="font-size:17px;color:#fff"><b>Cadastro efetuado!</b></span>
                    <br />
                    <br />
                    <div v-if="$root.usuario.idTipo == 1">
                        <span style="font-size:17px;color:#fff;font-weight:700;padding:10px">Lhe enviamos um e-mail com um link para você <b>CONFIRMAR O CADASTRO.</b><br />E-mail enviado por <b>site@jacaptei.com.br</b>, verifique a caixa de SPAM se não receber.</span>
                        <br />
                        <br />
                        <q-btn label="Ok" color="secondary" style="font-size:18px;width:50%;height:50px;border-radius:20px" @click="ShowView('form')"></q-btn>
                    </div>
                    <div v-else-if="$root.usuario.idTipo == 2">
                        <div style="font-size:17px;color:#fff;font-weight:700;padding:10px">Agora é só entrar em contato para vender seu imóvel</div>
                        <div style="background-color:#fff;color:var(--s-accent-color);font-weight:700;padding:10px">
                            <q-btn color="green-7" style="font-size:20px;min-width:320px;width:50%;height:30px;border-radius:20px" @click="VenderAgora()">
                                <i class="fab fa-whatsapp" style="font-size:26px;margin-right:10px;font-weight:500"></i>	VENDER AGORA  (31) 4003-9998
                            </q-btn>
                        </div>
                        <br />
                        <br />
                        <q-btn label="voltar" color="secondary" style="font-size:18px;width:240px;height:50px;border-radius:20px" @click="ShowView('form')"></q-btn>
                    </div>
                    <div v-else>
                        <br />
                        <br />
                        <q-btn label="Ok" color="secondary" style="font-size:18px;width:50%;height:50px;border-radius:20px" @click="ShowView('form')"></q-btn>
                    </div>
                </div>
            </div>

            <div v-else-if="view=='fail'">
                <div class="title" style="color:var(--s-color-red)"><b><i class="fa fa-circle-xmark"></i> Falhou</b></div>
                <br /><br />
                <br /><span v-html="messageFail"></span>
                <br /><br />
                <q-btn color="white" text-color="indigo-10" label="VOLTAR" @click="ShowView(viewLast)" style="width:160px;" id="btn_voltar_5"></q-btn>
            </div>
        </div>
    </div>
</template>


<script>
    module.exports = {
        name: 'JaCapteiConviteMembros',
        components: {},

        data: function () {
            return {
                onRequest: true,
                id: null,
                cod: null,
                url: window.location,
                usuario: {},
                onRequest: false,
                view: "form",
                viewLast: "form",
                messageSuccess: "Cadastrado!",
                messageAlert: "",
                contaNova: true,
                messageFail: "Não foi possível autenticar, favor tentar novamente.",
                content: "",
                DiaNascimento: 0,
                MesNascimento: 0,
                AnoNascimento: 0,
                senhaConfirma: "",
                carregandoCEP: false,
                carregandoEstados: false,
                carregandoCidades: false,
                carregandoBairros: false,
                carregandoEstadosCreci: false,
                carregandoCidadesCreci: false,
                estadoSelecionado: {},
                cidadeSelecionada: {},
                bairroSelecionado: {},
                cep: {
                    numero: "",
                    estado: "",
                    cidade: "",
                    logradouro: ""
                },
                opcoes: {
                    cidades: [],
                    estados: this.$root.localidade.estados,
                    estadosCreci: this.$root.localidade.estados,
                    cidadesCreci: [],
                    bairros: [],
                    sexos: [{ id: 1, label: "NÃO APLICÁVEL", value: "NA" }, { id: 2, label: "MASCULINO", value: "MASCULINO" }, { id: 3, label: "FEMININO", value: "FEMININO" }],
                }
            }
        },
        computed: {},
        created: function () {
            try {
                var queryParams = this.$tools.HandleParams();
                this.cod = queryParams.cod;
                this.BuscarContaPeloToken();
            } catch (e) {}
        },

        mounted() {},
        methods: {
            async BuscarContaPeloToken() {
                var buscarConta = [];
                var request = await this.$api.Get(`parceiro/obtercontapelotoken/${encodeURIComponent(this.cod)}`);

                if (request?.status?.success) {
                    buscaImovel = request.result;
                    this.imovel = buscaImovel.result.imoveis[0];
                    if (this.$validator.not(this.imovel))
                        this.indisponivel = true;
                    else
                        this.SetupImagens();
                } else
                    this.indisponivel = true;

                this.onRequest = false;
            },
        }
    }
</script>

<style scoped>
    .container {
        width: 100%;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        padding: 20px;
        box-sizing: border-box;
        border-radius: 8px;
    }

    .input-form {
        letter-spacing: 0.02em;
        color: #EF5924;
        margin-top: 2px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 15px;
        width: 100%;
        font-weight: bold;
    }

    .header {
        text-align: center;
        margin-bottom: 20px;
    }

    .invite-form {
        background-color: #dedede;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .birth-date {
        display: flex;
        gap: 10px;
    }

    .submit-button {
        margin-top: 20px;
    }

    @media (max-width: 600px) {
        .invite-form {
            padding: 15px;
        }

        .birth-date {
            flex-direction: column;
        }

        .submit-button {
            margin-top: 10px;
        }
    }
</style>