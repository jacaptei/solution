<template>

    <div class="row">

        <div class="col-12" style="width:100%;text-align:center;padding:40px;padding-left:0px" v-if="onRequest">
            <c-loading size="60px"></c-loading>
        </div>


        <div class="col-12" v-else>

            <div class="row">
                <div class="col-12 sm-hide md-hide lg-hide xl-hide">

                    <!--<el-carousel :interval="4000" type="card" height="400px" style="cursor:pointer;height:400px">
                        <el-carousel-item v-for="(item,index) in images" :key="index" @click="OpenModalImages(index)">
                                <img :src="item" />
                                <div style="width:100%;text-align:center">{{index+1}} / 4</div>
                        </el-carousel-item>
                    </el-carousel>-->

                    <el-carousel :interval="4000" height="400px" style="cursor:pointer;height:400px" v-if="imovel.imagens.length > 0">
                        <el-carousel-item v-for="(item,index) in imovel.imagens" :key="index">
                            <img :src="item.url" />
                            <div style="width:100%;text-align:center">{{index+1}} / {{imovel.imagens.length}}</div>
                        </el-carousel-item>
                    </el-carousel>
                    <el-carousel :interval="0" arrow="never" style="border-radius:14px 0px 0px 14px;" v-else>
                        <el-carousel-item style="cursor:pointer;">
                            <img src="/resources/images/noimages.jpg" />
                        </el-carousel-item>
                    </el-carousel>


                    <q-btn label="Entrar em contato" color="primary" style="width:100%;height:40px;margin-top:20px" @click="$tools.SlideTo('form')"></q-btn>

                </div>

            </div>
            <div class="row">

                <div class="col-6 xs-hide" style="height:400px" v-if="imovel.imagens.length > 0">
                    <img style="padding:10px;padding-top:0px;cursor:pointer;padding-bottom:0px" :src="image.url" @click="OpenModalImages(imageIndex)" />  <!--fits = ['fill', 'contain', 'cover', 'none', 'scale-down']-->
                    <div style="width:100%;text-align:center"><q-btn flat icon="fa fa-caret-left" :ripple="false" @click="HilightImage(imageIndex-1)"></q-btn>{{imageIndex+1}} / {{imovel.imagens.length}}<q-btn flat icon="fa fa-caret-right" :ripple="false" @click="HilightImage(imageIndex+1)"></q-btn></div>
                </div>
                <div class="col-6 xs-hide" style="width:480px" v-else>
                    <img style="padding:10px;padding-top:0px;cursor:pointer;padding-bottom:0px" src="/resources/images/noimages.jpg" />
                </div>

                <div class="col-1" style="max-width:10px"></div>

                <div class="col-5 xs-hide" style="display:inline-block">
                    <div class="row" style="max-height:400px;overflow-y:auto">
                        <div class="col-6" v-for="(item,index) in images" :key="index" @click="HilightImage(index)" style="text-align:center">
                            <!--<img :src="item" style="width: 100%; padding:10px;padding-top:5px;padding-bottom:5px;border:5px solid #fff"  />-->  <!--fits = ['fill', 'contain', 'cover', 'none', 'scale-down']-->
                            <el-image style="cursor:pointer;width:calc(100% - 20px);height:192px;padding:10px;padding-right:0px;padding-top:0px" :src="item.url" fit="cover"></el-image>  <!--fits = ['fill', 'contain', 'cover', 'none', 'scale-down']-->
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">


                <div class="col-12" id="build-info">

                    <div id="body" class="row">
                        <div class="col-md-7 col-sm-12 col-xs-12" style="text-align:right">

                            <div style="max-width:800px;text-align:left">

                                <div id="title" style="color:var(--s-accent-color)">
                                    <div style="width:calc(100% - 140px);">
                                        {{$imovelHandler.BuildTitle(imovel)}}
                                    </div>

                                    <div style="float:right;padding-right:20px">
                                        <span style="font-weight:600;font-size:11pt;padding-right:10px"><span style="color:var(--s-accent-color);">CÓD </span><span style="color:var(--s-alt-accent-color);font-size:12pt">{{imovel.cod}}</span></span>
                                        <!--<div v-if="favoritando" style="width:19px;display:inline-block">
                                            <c-loading size="14px"></c-loading>
                                        </div>
                                        <div v-else-if="$root.isAuth" @click="SetFavorite()" style="width:19px;display:inline-block">
                                            <i :class="imovel.favorito? 'fa fa-heart':'far fa-heart'" style="color:var(--s-accent-color);font-size:14pt;cursor:pointer" :title="imovel.favorito? 'remover dos favoritos':'favoritar'"></i>
                                        </div>
                                        <div v-else @click="OpenLogin()" style="width:19px;display:inline-block">
                                            <i class="far fa-heart" style="color:var(--s-color-grey);font-size:14pt;cursor:pointer" title="faça o login para poder favoritar"></i>
                                        </div>-->
                                    </div>

                                </div>
                                <div id="subtitle">
                                    <span v-if="$validator.is(imovel.bairro)">{{imovel.bairro}}, </span>
                                    <span v-if="$validator.is(imovel.cidade)">{{imovel.cidade}}, </span>
                                    <span v-if="$validator.is(imovel.estado)">{{imovel.estado}}  </span>
                                    <br />
                                </div>

                                <div id="location">
                                    <i class="icons fa fa-map-marker-alt"></i>
                                    <span v-if="$root.isAuth">
                                        <span v-if="$validator.is(imovel.endereco)">{{imovel.endereco}}, </span>
                                        <span v-if="$validator.is(imovel.numero)">{{imovel.numero}}, </span>
                                        <span v-if="$validator.is(imovel.andar && imovel.andar > 0)">{{imovel.andar}}º andar,  </span>
                                    </span>
                                    <span v-if="$validator.is(imovel.bairro)">{{imovel.bairro}}, </span>
                                    <span v-if="$validator.is(imovel.cidade)">{{imovel.cidade}}, </span>
                                    <span v-if="$validator.is(imovel.estado)">{{imovel.estado}}  </span>

                                </div>


                                <el-col class="price">
                                    <el-row>
                                        <el-col :md=8>Valor de Venda<br /><span>{{$tools.FormatMoneyBR(imovel.valor)}}</span></el-col>
                                        <el-col v-if="$root.isAuth" :md=8>Condomínio<br /><span>{{$tools.FormatMoneyBR(imovel.valorCondominio)}}</span></el-col>
                                        <el-col v-if="$root.isAuth" :md=8>IPTU<br /><span>{{$tools.FormatMoneyBR(imovel.valorIPTU)}}</span></el-col>
                                    </el-row>
                                </el-col>

                                <el-col>
                                    <el-row>
                                        <el-col :md=24 style="font-size:12px;padding:10px;padding-top:0px;color:#a5a5a5">Os preços e informações poderão sofrer mudanças sem aviso prévio. Poreste motivo, solicitamos a confirmação com nossos consultores.</el-col>
                                    </el-row>
                                </el-col>

                                <el-col>
                                    <el-row>
                                        <el-col :md=24 class="space"></el-col>
                                    </el-row>
                                </el-col>

                                <el-col id="resources">
                                    <el-row>
                                        <el-col :md=6> <i class="icons mdi mdi-bed-king"></i>{{imovel.quartos}} quartos</el-col>
                                        <el-col :md=6> <i class="icons fa fa-shower"></i>{{imovel.banheiros}} banheiros</el-col>
                                        <el-col :md=6> <i class="icons fa fa-bath"></i>{{imovel.suites}} suítes</el-col>
                                        <el-col :md=6 v-if="$root.isAuth"> <i class="icons fa fa-building"></i><span v-if="$validator.is(imovel.andar && imovel.andar > 0)">{{imovel.andar}}º andar</span><span v-else>térreo</span></el-col>
                                        <el-col :md=6> <i class="icons fa fa-car "></i>{{imovel.vagas}} vagas</el-col>
                                        <el-col :md=6> <i class="icons mdi mdi-set-square "></i>{{imovel.areaTotal}} m&#178; <span style="color:#a5a5a5"> &nbsp;total</span></el-col>
                                        <el-col :md=6> <i class="icons mdi mdi-set-square "></i>{{imovel.areaInterna}} m&#178; <span style="color:#a5a5a5"> &nbsp;interna</span></el-col>
                                        <el-col :md=6> <i class="icons mdi mdi-set-square "></i>{{imovel.areaExterna}} m&#178;  <span style="color:#a5a5a5"> &nbsp;externa</span></el-col>
                                    </el-row>
                                </el-col>




                                <el-col>
                                    <el-row>
                                        <el-col :md=24 id="title">Descrição do Imóvel</el-col>
                                        <el-col :md=24 class="space"></el-col>
                                        <el-col :md=24>

                                            <div v-if="$validator.is(imovel.descricao)" style="font-size:17px;line-height:28px;text-align: justify;  text-justify: inter-word;">
                                                <span v-html="imovel.descricao"></span>
                                            </div>
                                            <div v-else class="s-orange">
                                                <i class="fa fa-exclamation-circle"></i> não informado
                                                <!--
                                                Apartamento à venda no Cidade Nova, composto por 04 quartos amplos com armários planejados e
                                                piso em laminado de madeira, sendo 01 suíte máster com closet e hidromassagem e 01 suíte ampla,
                                                banho das suítes com bancada em granito, armário, espelho e box em blindex, banho social com
                                                bancada em granito, armário, espelho e box em blindex, ampla sala para 02 ambientes com
                                                rebaixamento em gesso, iluminação planejada e piso em porcelanato, varanda, cozinha com
                                                armários planejados e bancadas em granito, área de serviço separada com armário e DCE.
                                                <br /><br />
                                                Prédio com interfone, portão eletrônico, guarita, elevador social, gás canalizado, medidor de água
                                                individual, circuito de TV, sistema de alarmes, lazer com 03 piscinas aquecidas, academia, quadra de
                                                esportes, sauna, espaço gourmet e salão de festas, excelente localização privilegiada, próximo a
                                                todo tipo de comércio e com fácil acesso a linhas de ônibus.
                                                <br /><br />
                                                Agende já sua visita!!!!
                                                    -->
                                            </div>
                                        </el-col>
                                    </el-row>
                                </el-col>

                                <el-col style="margin-top:40px;margin-bottom:40px;">
                                    <el-row>
                                        <el-col :md=24 id="title">Características</el-col>
                                        <el-col :md=24 class="space"></el-col>

                                        <!--<el-col :md=24  v-if="!temCaracteristicas" class="s-orange">
                                           <i class="fa fa-exclamation-circle"></i> não informado
                                        </el-col>
                                        <el-col :md=24 v-else>-->
                                        <el-col :md=24>
                                            <el-row>
                                                <el-col :md="24">
                                                    <!--<el-checkbox checked readonly label="Água individual   "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Alarme            "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Área de Serviço   "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Armário cozinha   "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Armário banheiro  "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Armário quarto    "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Box despejo       "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Cerca elétrica    "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Churrasqueira     "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Closet            "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="DCE               "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Gás canalizado    "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Hidromassagem     "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Interfone         "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Jardim            "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Lavabo            "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Piscina           "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Portao eletrônico "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Salas             "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Salão de festas   "></el-checkbox><br />
                                                    <el-checkbox checked readonly label="Quadra esportiva  "></el-checkbox>-->
                                                </el-col>

                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.aguaIndividual    "><el-checkbox checked readonly label="Água individual   " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.alarme            "><el-checkbox checked readonly label="Alarme            " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.areaServico       "><el-checkbox checked readonly label="Área de Serviço   " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.armarioCozinha    "><el-checkbox checked readonly label="Armário cozinha   " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.armarioBanheiro   "><el-checkbox checked readonly label="Armário banheiro  " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.armarioQuarto     "><el-checkbox checked readonly label="Armário quarto    " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.boxDespejo        "><el-checkbox checked readonly label="Box despejo       " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.cercaEletrica     "><el-checkbox checked readonly label="Cerca elétrica    " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.churrasqueira     "><el-checkbox checked readonly label="Churrasqueira     " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.closet            "><el-checkbox checked readonly label="Closet            " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.dce               "><el-checkbox checked readonly label="DCE               " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.gasCanalizado     "><el-checkbox checked readonly label="Gás canalizado    " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.hidromassagem     "><el-checkbox checked readonly label="Hidromassagem     " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.interfone         "><el-checkbox checked readonly label="Interfone         " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.jardim            "><el-checkbox checked readonly label="Jardim            " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.lavabo            "><el-checkbox checked readonly label="Lavabo            " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.piscina           "><el-checkbox checked readonly label="Piscina           " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.portaoEletronico  "><el-checkbox checked readonly label="Portao eletrônico " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.salas             "><el-checkbox checked readonly label="Salas             " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.salaoFestas       "><el-checkbox checked readonly label="Salão de festas   " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>
                                                <el-col :md="12" :sm="12" :xs="12" v-if="imovel.quadraEsportiva   "><el-checkbox checked readonly label="Quadra esportiva  " v-model="checkboxes" @change="checkboxes=true" text-style="font-size:17px"></el-checkbox></el-col>

                                            </el-row>
                                        </el-col>

                                    </el-row>






                                </el-col>


                            </div>
                        </div>

                        <div class="col-1" style="max-width:100px"></div>




                        <div class="col-md-4 col-sm-12 col-xs-12">
                            <div class="building-form-wrapper">
                                <div class="building-form" style="color:#fff" id="form">

                                    <el-row :gutter="20">
                                        <el-col :md="24" style="width:100%;text-align:center;font-weight:600;font-size:16pt;margin-top:10px;margin-bottom:20px;">
                                            Envie o link deste imóvel para seu corretor de confiança
                                        </el-col>
                                    </el-row>

                                    <!--<el-row :gutter="20">
                                            <el-col :md="24" style="">
                                                    <div style="height:1px;background-color:#fff;"></div>
                                            </el-col>
                                    </el-row>

                                    <el-row :gutter="20">
                                            <el-col :md="24" style="width:100%;color:#ffff8b;text-align:center;padding:20px;font-weight:600;font-size:14pt;word-wrap:anywhere">
                                                       {{url}}
                                            </el-col>
                                    </el-row>-->

                                    <el-row :gutter="20" style="padding:6px;margin-top:5px;padding-bottom:-14px">
                                        <el-col :md="24">
                                            <q-btn id="bt-send" label="Copiar link" icon="fa fa-copy" color="secondary" style="font-size:18px;width:100%;height:50px;border-radius:20px" @click="CopyLink"></q-btn>
                                            <div style="width:100%;text-align:center;padding-top:14px;">
                                                <span v-if="copylinkLoading"> <c-loading size="20px" color="white"></c-loading></span>
                                                <span v-else>{{copylinkMessage}}</span>
                                            </div>
                                        </el-col>
                                    </el-row>

                                </div>
                            </div>

                            <div style="margin:20px"></div>

                            <c-schedule :imovel="imovel" :link="url"></c-schedule>

                        </div>




                        <!--
                                                               <div class="col-md-4 col-sm-12 col-xs-12">
                                                                    <div class="building-form-wrapper">
                                                                        <div class="building-form" style="color:#fff" id="form">

                                                                                <el-row :gutter="20">
                                                                                        <el-col :md="24" style="width:100%;text-align:center;font-weight:600;font-size:16pt;height:60px;line-height:60px;vertical-align:middle">
                                                                                                 Entre em contato
                                                                                        </el-col>
                                                                                </el-row>
                                                                                <el-row :gutter="20">
                                                                                        <el-col :md="24" style="">
                                                                                                <div style="height:1px;background-color:#fff;"></div>
                                                                                        </el-col>
                                                                                </el-row>
                                                                                <el-row :gutter="20" style="margin-bottom:10px">
                                                                                        <el-col :md="24" style="width:100%;text-align:center;font-weight:600;font-size:16pt;height:60px;line-height:60px;vertical-align:middle">
                                                                                                 (31) 9999-99999
                                                                                        </el-col>
                                                                                        <el-col :md="24" style="width:100%;text-align:center;font-weight:600;font-size:16pt;height:60px;vertical-align:top">
                                                                                                <q-btn id="bt-whats" label="Enviar Whatsapp" color="green-14" icon="fab fa-whatsapp" style="font-size:18px;width:100%;height:50px;border-radius:20px"></q-btn>
                                                                                        </el-col>
                                                                                </el-row>


                                                                                <el-row :gutter="20">
                                                                                        <el-col :md="24">
                                                                                                        <div></div>
                                                                                                        <el-input  color="secondary" v-model="$root.usuario.nome" placeholder="nome" maxlength="80" ></el-input>
                                                                                        </el-col>
                                                                                </el-row>

                                                                                <el-row :gutter="20">
                                                                                        <el-col :md="24">
                                                                                                        <el-input  color="secondary" v-model="$root.usuario.email" placeholder="e-mail" maxlength="80" ></el-input>
                                                                                        </el-col>
                                                                                </el-row>

                                                                                <el-row :gutter="20">
                                                                                        <el-col :md="24">
                                                                                                        <el-input  color="secondary" v-model="$root.usuario.telefone" placeholder="telefone" maxlength="80" ></el-input>
                                                                                        </el-col>
                                                                                </el-row>

                                                                                <el-row :gutter="20">
                                                                                        <el-col :md="24">
                                                                                                        <el-input  show-word-limit   color="secondary"  type="textarea" input-style="height:100px;border-radius:9px" v-model="$root.usuario.mensagem" placeholder="" maxlength="400" ></el-input>
                                                                                        </el-col>
                                                                                </el-row>

                                                                                <el-row :gutter="20" style="padding:6px;margin-top:5px">
                                                                                        <el-col :md="24">
                                                                                                <q-checkbox v-model="$root.usuario.permiteContato" label="Aceito receber novidades da Jácaptei" color="secondary" size="xs" ></q-checkbox>
                                                                                        </el-col>
                                                                                </el-row>

                                                                                <el-row :gutter="20" style="padding:6px;margin-top:5px">
                                                                                        <el-col :md="24">
                                                                                                <q-btn id="bt-send" label="Enviar" icon="fa fa-paper-plane" color="secondary" style="font-size:18px;width:100%;height:50px;border-radius:20px" @click="Send"></q-btn>
                                                                                        </el-col>
                                                                                </el-row>

                                                                                <el-row :gutter="20" style="padding:6px;margin-top:5px">
                                                                                        <el-col :md="24" style="text-align:center;font-size:9pt;color:#f8c8b7">
                                                                                               Ao informar meus dados, eu concordo com a Politica de Privacidade.
                                                                                        </el-col>
                                                                                </el-row>


                                                                        </div>
                                                                    </div>
                                                               </div>
                             -->



                    </div>
                </div>

            </div>


            <el-row style="margin:40px;margin-top:20px;">
                <el-col :md=24 id="title">Mapa</el-col>
                <el-col :md=24 class="space"></el-col>
                <el-col :md=24>
                    <iframe width="600" height="450" style="border:0;border-radius:20px;width:100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" id="gmap_canvas" :src="'https://maps.google.com/maps?hl=pt&amp;q='+BuildMapAddress()+'+()&amp;t=&amp;z=15&amp;ie=UTF8&amp;iwloc=B&amp;output=embed'"></iframe>
                    <!--<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3752.2183082941474!2d-43.92566310000001!3d-19.873001600000002!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xa69a8b42515555%3A0x533985eab790cf5e!2sR.%20Queluzita%2C%2034%20-%2015%C2%BA%20Andar%20-%20Fern%C3%A3o%20Dias%2C%20Belo%20Horizonte%20-%20MG%2C%2031910-252!5e0!3m2!1sen!2sbr!4v1695664157204!5m2!1sen!2sbr" width="600" height="450" style="border:0;border-radius:20px;width:100%" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>-->
                    <!--<iframe width="520" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" id="gmap_canvas" src="https://maps.google.com/maps?width=520&amp;height=400&amp;hl=en&amp;q=%20S%C3%A3o%20Paulo+()&amp;t=&amp;z=12&amp;ie=UTF8&amp;iwloc=B&amp;output=embed"></iframe><a href='https://maps-generator.com/'>Maps Generator</a>-->
                    <!--<iframe width="600" height="450" style="border:0;border-radius:20px;width:100%" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" id="gmap_canvas" :src="BuildMapAddress()"></iframe>-->
                    <!--<iframe width="600" height="450" style="border:0;border-radius:20px;width:100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" id="gmap_canvas" :src="'https://maps.google.com/maps?hl=en&amp;q='+BuildMapAddress()+'+()&amp;t=&amp;z=12&amp;ie=UTF8&amp;iwloc=B&amp;output=embed'"></iframe>-->
                </el-col>
            </el-row>


            <!--<el-row style="margin:40px;">
                <el-col :md=24  id="title">Mais imóveis na região</el-col>
                <el-col :md=24  class="space"></el-col>
                <el-col :md=24>

                    <q-virtual-scroll style="max-height: 300px;" :items="relatedBuildings" separator v-slot="{ item, index }" virtual-scroll-horizontal>
                            <div :key="index" class="row items-center" style="max-width:200px">
                                <c-building-mini-card></c-building-mini-card>
                            </div>
                        <q-separator vertical spaced ></q-separator>
                    </q-virtual-scroll>

                </el-col>
            </el-row>-->


            <div class="row">
                <div style="width:100%;text-align:center">
                    <el-col :md="24" style="margin-top:20px">
                        <q-btn label="Voltar" color="secondary" style="width:200px;height:40px" @click="$root.RouteTo('/busca')"></q-btn>
                    </el-col>
                </div>
            </div>

        </div>





        <el-dialog v-model="showModalImages" :title="imovel.title">

            <q-carousel v-model="imageIndex"
                        arrows
                        navigation
                        swipeable
                        animated
                        infinite>
                <template v-slot:navigation-icon="{ active, btnProps, onClick }">
                    <q-btn v-if="active" size="5px" color="orange"></q-btn>
                    <q-btn v-else size="4px" color="white" @click="onClick"></q-btn>
                </template>

                <q-carousel-slide v-for="(item,index) in imovel.imagens" :name="index" :img-src="item.url">

                </q-carousel-slide>
                <!--<q-carousel-slide :name="1" img-src="https://cdn.quasar.dev/img/mountains.jpg" />
                <q-carousel-slide :name="2" img-src="https://cdn.quasar.dev/img/parallax1.jpg" />
                <q-carousel-slide :name="3" img-src="https://cdn.quasar.dev/img/parallax2.jpg" />
                <q-carousel-slide :name="4" img-src="https://cdn.quasar.dev/img/quasar.jpg" />-->
            </q-carousel>

        </el-dialog>


    </div>



</template>


<script>
    module.exports = {

        components: {

        },

        data: function () {
            return {

                onRequest: true,
                showModalImages: false,
                temCaracteristicas: false,
                favoritando: false,
                fromCache: false,

                imageIndex: 0,
                imovel: null,
                id: null,
                cod: null,

                imagesTotal: 0,
                images: [],
                imageIndex: 0,
                image: "",
                relatedBuildings: [],

                checkboxes: true,

                url: window.location,
                copylinkLoading: false,
                copylinkMessage: "",


            }


        }, computed: {

        },
        created: function () {

            //params = this.$tools.HandleParams();
            //c2("params", params)
            //this.id = params.id;
            //this.cod = params.cod;

            if (this.is(this.$route.query)){
                this.id     = this.$route.query.id;
                this.cod    = this.$route.query.cod;
            }else{
                params      = this.$tools.HandleParams();
                //c2("params", params)
                this.id     = params.id;
                this.cod    = params.cod;
            }

            //this.images = this.imagesData.sort((a, b) => 0.5 - Math.random()).slice(0, this.imagesTotal);
            //this.images = this.imagesData.sort((a, b) => 0.5 - Math.random()).slice(0, this.imagesTotal);

            //if(this.$validator.is(this.$root.imovelClicado) && this.$validator.is(this.$root.imovelClicado?.cod))
            //     this.imovel = this.$root.imovelClicado;
            //else{
            //     this.imovel = this.$sdata.Storage.Get("imovel"+this.$route.query.cod);
            //}

            var key = "imovel_cod_" + this.cod + "_id_" + this.id;
            this.imovel = this.$sdata.Storage.Get(key);
            if (this.$validator.not(this.imovel)) {
                this.fromCache = false;
                this.Search();
            } else
                this.fromCache = true;



            if (this.is(this.$sdata.Storage.Get("usuario"))) {
                //this.$root.usuario = JSON.parse(this.$sdata.Storage.Get("usuario"));
                this.$root.usuario = this.$sdata.Storage.Get("usuario");
                if (this.$root.usuario.id > 0)
                    this.$root.isAuth = true;
            }

        },

        mounted() {

            if (this.fromCache) {
                if (this.imovel.imagens.length > 0) {
                    this.images = this.imovel.imagens;
                    this.image = this.imovel.imagens[0];
                    this.imagesTotal = this.imovel.imagens.length;
                    this.onRequest = false;
                } else {
                    this.images = [];
                    this.image = "/resources/images/noimages.jpg";
                }

                const maxSize = 20;

                for (let i = 0; i < maxSize; i++) {
                    this.relatedBuildings.push({
                        label: 'Imóvel ' + (i + 1)
                    })
                }
            }


            //c2("imovel.armarioBanheiro",this.imovel.armarioBanheiro)



            //c2("this.$root.usuario", this.$root.usuario);
            //this.$sdata.Storage.Set("usuario",null);



        },
        methods: {

            is(val) {
                return (val && val != null && val !== null && val !== "null" && val != "null" && val != "" && typeof val != undefined && typeof val !== undefined && typeof val != 'undefined' && typeof val != 'UNDEFINED' && typeof val !== 'undefined' && typeof val !== 'UNDEFINED');
            },

            CopyLink() {
                navigator.clipboard.writeText(this.url);
                this.copylinkLoading = true;
                window.setTimeout(() => {
                    this.copylinkMessage = "link copiado para área de transferência";
                    this.copylinkLoading = false;
                }, 600);
            },

            async SetFavorite() {
                this.favoritando = true;
                var res = await this.$imovelHandler.Favoritar(this.$root.usuario.sessaoCRMsystem, this.$root.usuario.id, this.$root.usuario.idCRM, this.imovel.id, this.imovel.id, !this.imovel.favorito);
                if (res.success) {
                    this.imovel.favorito = !this.imovel.favorito;
                    if (this.imovel.favorito)
                        this.$root.usuario.favoritos.push(res.favorito);
                    else {
                        //const index = this.$root.usuario.favoritos.indexOf(this.imovel.id);
                        const index = this.$root.usuario.findIndex(fav => fav.idImovelCRM === this.imovel.id);
                        if (index > -1)
                            this.$root.usuario.favoritos.splice(index, 1);
                    }
                    cclear();
                    carray(this.$root.usuario.favoritos)
                } else
                    this.$tools.Alert("Não foi possível favoritar");

                this.$sdata.Storage.Set("favoritos", []);
                this.$sdata.Storage.Set("favoritos", this.$root.usuario.favoritos);
                //window.setTimeout(()=>this.favoritando = false,800);
                this.favoritando = false;
            },

            OpenLogin() {
                this.$tools.MessageAlert("necessário login para favoritar", 100);
                window.setTimeout(() => this.$root.OpenLoginModal(), 600);
            },


            ValidarCaracteristica(carac) {
                if (carc == 1)
                    this.temCaracteristicas = true;
                return (carac == 1);
            },


            BuildMapAddress() {
                var res = "";
                res += this.$validator.is(this.imovel.endereco) ? this.imovel.endereco + "," : "";
                //res += this.$validator.is(this.imovel.numero    )? this.imovel.numero   +",":"";
                res += this.$validator.is(this.imovel.bairro) ? this.imovel.bairro + "," : "";
                res += this.$validator.is(this.imovel.cidade) ? this.imovel.cidade + "," : "";
                res += this.$validator.is(this.imovel.estado) ? this.imovel.estado + "" : "";
                res = res.replaceAll(" ", "%20");
                //res = "https://maps.google.com/maps?q="+res+"+()&amp;t=&amp;z=12&amp;ie=UTF8&amp;iwloc=B&amp;output=embed";
                //c(res)
                return res;
            },




            HilightImage(index) {
                //c(index);
                if (index > (this.imagesTotal - 1))
                    index = 0;
                else if (index < 0)
                    index = (this.imagesTotal - 1);
                this.imageIndex = index;
                this.image = this.images[index];
            },


            OpenModalImages(index) {
                this.imageIndex = index;
                //window.setTimeout(()=>this.showModalImages=true,2000)
                this.showModalImages = true;

            },



            Search() {

                this.onRequest = true;

                this.results = [];

                this.imovel     = {};
                var imovelBusca = {};
                imovelBusca.imovel = {};
                imovelBusca.imovel.id  = this.id;
                imovelBusca.imovel.cod = this.cod;


                axios.post(this.$api.BuildURL("imovel/buscar"), imovelBusca).then((request) => {
                    
                    //c2("request.data", request.data);
                    
                    if (request.data.status.success) {

                        if (this.$validator.is(request.data.result.crmResult) && request.data.result.crmResult?.result?.records?.length > 0){

                            var imoveisRes = request.data.result.crmResult.result.records;
                            var imagensRes = JSON.parse(request.data.result.result.imagensJson);

                            //for(var i=0;i<imoveisRes.length;i++){
                            var i = 0;
                            var imovelCRM = imoveisRes[i];

                            imovelCRM.id  = this.id;
                            imovelCRM.cod = this.cod;

                            //this.imovel.imagens = this.imagesData.sort((a, b) => 0.5 - Math.random()).slice(0, 4);

                            var imovel = this.$imovelHandler.Parse(this.imovel, imovelCRM, i);
                            imovel.imagens = [];
                            imovel.thumbs = [];
                            //this.imovel.imagens       = request.data.result.images.filter(img => img.idImovel == this.imovel.id);
                            if (this.$validator.is(imagensRes) && this.$validator.is(imagensRes?.result[imovel.idCRM])){
                                imagensRes.result[imovel.idCRM].forEach(    
                                    img =>{ 
                                            //img.url = "https://imagizer.imageshack.com/v2/100x75q70/924/knaP8O.jpg"; 
                                            imovel.imagens.push(img); 
                                            imovel.thumbs.push(img); 
                                             
                                          }
                                );
                            }

                            this.imovel = imovel;
                            //c2("this.imovel", this.imovel);

                            this.images      = this.imovel.imagens;
                            this.image       = this.imovel.imagens[0];
                            this.imagesTotal = this.imovel.imagens.length;


                            /*
                            this.imovel.imagens       =   this.imagesData.sort((a, b) => 0.5 - Math.random()).slice(0, 4);
                            this.imovel.id           =   item.id.split("x")[1];
                            this.imovel.idModule     =   item.id.split("x")[0];
                            this.imovel.cod          =   item.productcode;
                            this.imovel.tipo         =   item.productcategory;
                            this.imovel.index        =   i;
                            this.imovel.nome         =   "build"+i;
                            this.imovel.estado       =   item.cf_1021;
                            this.imovel.cidade       =   item.cf_1019;
                            this.imovel.bairro       =   item.cf_1011;
                            this.imovel.endereco     =   item.cf_1001;
                            this.imovel.numero       =   item.cf_1003;
                            this.imovel.andar        =   item.cf_1033;

                            this.imovel.quartos      =   item.cf_1041;
                            this.imovel.vagas        =   item.cf_1097;
                            this.imovel.banheiros    =   item.cf_1035;
                            this.imovel.suites       =   item.cf_1045;
                            this.imovel.areaInterna  =   item.cf_1203;
                            this.imovel.areaExterna  =   item.cf_1205;
                            this.imovel.areaTotal    =   parseFloat(this.imovel.areaInterna) + parseFloat(this.imovel.areaExterna);

                            this.imovel.valor        =   parseFloat(this.item.unit_price);


                            // booleans
                            this.imovel.areaServico     = this.ValidarCaracteristica(item.cf_1053);
                            this.imovel.closet          = this.ValidarCaracteristica(item.cf_1063);
                            this.imovel.churrasqueira   = this.ValidarCaracteristica(item.cf_1147);
                            this.imovel.salas           = this.ValidarCaracteristica(item.cf_1043);
                            this.imovel.armarioBanheiro = this.ValidarCaracteristica(item.cf_1055);
                            this.imovel.armarioQuarto   = this.ValidarCaracteristica(item.cf_1059);
                            this.imovel.boxDespejo      = this.ValidarCaracteristica(item.cf_1121);
                            this.imovel.lavabo          = this.ValidarCaracteristica(item.cf_1071);
                            this.imovel.hidromassagem   = this.ValidarCaracteristica(item.cf_1149);
                            this.imovel.piscina         = this.ValidarCaracteristica(item.cf_1153);
                            this.imovel.quadraEsportiva = this.ValidarCaracteristica(item.cf_1157);
                            this.imovel.salaoFestas     = this.ValidarCaracteristica(item.cf_1163);
                            this.imovel.dce             = this.ValidarCaracteristica(item.cf_1065);
                            this.imovel.cercaEletrica   = this.ValidarCaracteristica(item.cf_1123);
                            this.imovel.jardim          = this.ValidarCaracteristica(item.cf_1131);
                            this.imovel.interfone       = this.ValidarCaracteristica(item.cf_1129);
                            this.imovel.armarioCozinha  = this.ValidarCaracteristica(item.cf_1057);
                            this.imovel.portaoEletronico= this.ValidarCaracteristica(item.cf_1135);
                            this.imovel.alarme          = this.ValidarCaracteristica(item.cf_1113);
                            this.imovel.aguaIndividual  = this.ValidarCaracteristica(item.cf_1111);
                            this.imovel.gasCanalizado   = this.ValidarCaracteristica(item.cf_1127);
                            */
                            //}

                        }

                    } else {
                        this.$tools.Alert("Não foi possível efetuar a busca.");
                    }
                }).catch((error) => {
                    ce(error);
                    if (error.response)
                        ce(error.response);
                    //this.api.status.success=false;
                    //this.validator.AlertResponseErrors(error);
                    //this.messageFail="Não foi possível efetuar a busca.";
                    ce("Não foi possível efetuar a busca.");
                }).finally(() => {
                    this.onRequest = false;
                    //this.OutputResultMap(request.data.imovel);
                    //window.setTimeout(()=>{this.api.status.requesting = false;},400);
                });



            },


















        }

    }

</script>


<!--<script setup>
const isCollapse = ref(true);
const handleOpen = function(key, keyPath){
  c(key, keyPath);
}
const handleClose = function(key, keyPath){
  c(key, keyPath);
}
</script>-->

<style scoped>


    .space {
        height: 2px;
        background-color: #efefef;
        margin-top: 10px;
        margin-bottom: 20px;
    }

    img {
        display: flex;
        justify-content: center;
        width: 100%;
        height: 100%;
    }


    #build-info {
        /*height:240px;*/
        width: 100%;
        border-radius: 14px;
        margin: 20px;
        margin-top: 40px;
        margin-bottom: 4px;
        text-align: center;
        /*box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;*/
    }

    #build-info-xs {
        height: auto;
        width: calc(100% - 22px);
        border-radius: 14px;
        margin: 20px;
        /*box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;*/
    }


    #carousel-thumbs {
        /*height:240px;*/
        display: inline-block;
        padding: 0px;
        max-width: 400px;
        width: 33%;
        float: left;
    }



    #carousel-thumbs-xs {
        display: block;
        padding: 0px;
        width: 100%;
    }

    #body {
        text-align: left;
        padding: 20px;
        max-width: 1360px;
    }

    #body-xs {
        text-align: left;
        padding: 40px;
        width: 180px;
    }

    #title {
        font-size: 22px;
        line-height: 26px;
        font-weight: 600;
        color: var(--s-text-color);
    }

    #subtitle {
        font-size: 18px;
        line-height: 28px;
        font-weight: 600;
        color: var(--s-text-color);
    }


    .icons {
        width: 28px;
        display: inline-block;
        text-align: center;
        line-height: 32px;
        color: var(--s-accent-color);
    }


    #location {
        font-size: 15px;
        line-height: 28px;
        font-weight: 500;
        color: #131A2E;
        color: #6a728a;
        padding: 10px 0px 5px 0px;
    }


    #resources {
        font-size: 15px;
        line-height: 20px;
        font-weight: 500;
        color: #131A2E;
        color: #6a728a;
        padding: 0px;
        margin-bottom: 40px;
    }


    #value {
        font-size: 25px;
        font-weight: 700;
        color: var(--s-accent-color);
        padding: 14px 0px 14px 0px;
    }


    #bt-whats .q-icon {
        font-size: 30px;
    }

    #bt-send .q-icon {
        font-size: 20px;
    }



    .el-carousel__item {
        background-color: #d3dce6;
    }

        .el-carousel__item div:nth-child(2) {
            z-index: 100000;
            color: #fff;
            text-shadow: -1px -1px 0 #353535, 1px -1px 0 #353535, -1px 1px 0 #353535, 1px 1px 0 #353535;
            margin-top: -26px;
            text-align: left;
            padding-left: 10px;
        }

        .el-carousel__item div:nth-child(3) {
            z-index: 100000;
            color: #fff;
            text-shadow: -1px -1px 0 #353535, 1px -1px 0 #353535, -1px 1px 0 #353535, 1px 1px 0 #353535;
            margin-top: -26px;
            text-align: right;
            padding-right: 10px;
        }



        .el-carousel__item span {
            color: #475669;
            opacity: 0.75;
            margin: 0;
            text-align: center;
        }
</style>


