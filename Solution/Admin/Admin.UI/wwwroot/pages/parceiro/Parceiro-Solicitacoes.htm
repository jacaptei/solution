<template>

	<div class="row">
		<div class="col-12">

			<div>

				<el-row :gutter="20" style="margin-bottom:20px">
					<el-col :md="10" style="max-width:420px;">
						<div>
							<q-date v-model="dataSelecionadaRange" style="text-align:left" minimal range @click="()=>{idSolicitacao = null;Enviar();}"></q-date>
						</div>
					</el-col>
					<el-col :md="10" style="padding-left:40px">
						<div class="s-input">
							<div>SOLICITAÇÃO ID# <span>outros campos serão ignorados</span></div>
							<el-input @keyup.enter="Enviar" v-model="idSolicitacao" maxlength="20" input-style="width:100px"></el-input>
						</div>
						<div class="s-input">
							<div>Status<span></span></div>
							<el-select v-model="idStatusSelecionado" filterable placeholder="Todos" style="max-width:190px" @change="()=>{idSolicitacao = null;Enviar();}">
								<el-option v-for="stat in status"
										   :key="stat.value"
										   :label="stat.nome"
										   :value="stat.value">
								</el-option>
							</el-select>
						</div>
						<div class="s-input" v-if="$root.usuario.god || $root.usuario.gestor">
							<div>Captador<span></span></div>
							<el-select v-model="idAdminSelecionado" filterable placeholder="Todos" style="max-width:190px" @change="()=>{idSolicitacao = null;Enviar();}">
								<el-option v-for="admin in admins"
										   :key="admin.id"
										   :label="admin.nome"
										   :value="admin.id">
								</el-option>
							</el-select>
						</div>
						<div style="padding-top:5px">
							<div><span></span></div>
							<q-btn color="primary" label="BUSCAR" style="width:120px" @click="Enviar"></q-btn>
						</div>
					</el-col>
				</el-row>

				<el-row :gutter="20" v-if="view == 'request' ">
					<el-col :md="24">
						<c-loading></c-loading>
					</el-col>
				</el-row>
				<el-row :gutter="20" v-else>
					<el-col :md="24">
						<div v-if="results.length == 0">
							nada encontrado
						</div>
						<div v-else>
							<div style="color:var(--s-color-primary);margin-bottom:10px">
								<span v-if="results.length == 1"><b>1</b> encontrado</span>
								<span v-else><b>{{results.length}}</b> encontrados</span>
							</div>
						</div>
						<div v-for="(item,index) in results">





							<div>
								<div>

									<el-row :gutter="20">

										<el-col :md="24">


											<q-card style="width:100%;color:#fff;margin-bottom:5px" v-if="item.ativo">
												<q-card-section style="cursor:pointer" @click="()=>{item.acaocard==('abrir-card'+item.id)?  item.acaocard=('fechar-card'+item.id) :  item.acaocard=('abrir-card'+item.id);}" :class="item.idStatus == 3? 'bg-yellow-9' : item.idStatus == 5? 'bg-primary' :  item.idStatus == 11? 'bg-red' : 'bg-teal' ">
													<div class="text-h10">
														<span class="text-h10">
															<b style="margin-right:10px;">ID# {{item.id}}</b>
															<i v-if="!item.validadoProprietario|| !item.validadaURL || !item.validadoEndereco" title="há dados invalidados" style="padding-left:4px;color:#fff;font-size:20px;" class="fa fa-warning"></i>
															<span v-if="item.agendado">
																<i title="agendado" style="padding-left:10px;padding-right:10px;color:#fff;font-size:17px;" class="fa fa-calendar"></i>
																{{$tools.FormatDateHour(item.dataVisita)}}
															</span>
														</span>
														<span class="text-h10">
															<span style="float:right">
																<span style="opacity:0.7;padding-right:20px">
																	Inserida em  {{$tools.FormatDateHour(item.data)}}
																</span>
																<span v-if="item.idStatus == 9 || item.idStatus == 10">
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Encontrada em {{$tools.FormatDateHour(item.dataAtualizacao)}} <i class="fa fa-thumbs-up" style="padding-left:10px"></i>
																</span>
																<span v-else-if="item.idStatus==11">
																	Não encontrada em {{$tools.FormatDateHour(item.dataAtualizacao)}} <i class="fa fa-thumbs-down" style="padding-left:10px"></i>
																</span>
																<span style="margin-left:15px;">
																	<i class="fa fa-caret-down" v-if="item.acaocard != ('abrir-card'+item.id)"></i>
																	<i class="fa fa-caret-up" v-else></i>
																</span>
															</span>
														</span>
													</div>
												</q-card-section>

												<q-card-section :id="'content'+item.id" v-if="item.acaocard==('abrir-card'+item.id)" style="margin-bottom:15px">

													<div>





														<div style="font-weight:500;color:#000;margin-bottom:10px">
															<el-input :value="'#'+item.admin.id + ' . '+item.admin.nome" readonly>
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right">
																		Admin   <i style="padding-left:10px" class="fa fa-user-gear"></i>
																	</div>
																</template>
															</el-input>
														</div>



														<div style="font-weight:500;color:#000">

															<el-input :value="'#'+item.parceiro.id + ', '+item.parceiro.apelido + ', '+item.parceiro.telefone + ', '+item.parceiro.email" readonly>
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-parceiro'?  item.acao='fechar-parceiro' :  item.acao='abrir-parceiro';}">
																		Parceiro  <i style="padding-left:10px" class="fa fa-user-alt"></i>
																	</div>
																</template>
																<template #append>
																	<div @click="()=>{item.acao=='abrir-parceiro'?  item.acao='fechar-parceiro' :  item.acao='abrir-parceiro';}" style="cursor:pointer;text-align:center">
																		<q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-parceiro'"></q-btn>
																		<q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
																	</div>
																</template>
															</el-input>
															<div v-if="item.acao=='abrir-parceiro'">
																<q-card>
																	<q-card-section>
																		<div style="line-height:30px;font-size:15px">
																			<div style="font-weight:500;color:var(--s-color-primary)">ID# {{item.parceiro.id}}</div>
																			<div style="font-weight:500;color:var(--s-color-primary)"> <i class="fa fa-user-alt"></i> {{item.parceiro.nome}}</div>
																			<div><a :href="$tools.BuildWhatsappLink(item.parceiro.telefone,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.parceiro.telefone}}</a>                                    </div>
																			<div v-if="$validator.IsCPF(item.parceiro.cpf)"><a href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cpf)" style="text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="text-decoration:none"></i>CPF: {{item.parceiro.cpf}}  </a>       </div>
																			<div v-else-if="$validator.IsCNPJ(item.parceiro.cnpj)"><a href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cnpj)" style="text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="text-decoration:none"></i>CNPJ: {{item.parceiro.cnpj}}  </a>     </div>
																			<div><a :href="'mailto:'+item.parceiro.email" target="_blank" style="color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.parceiro.email}}</a>                                                                                              </div>
																		</div>
																	</q-card-section>
																</q-card>
															</div>
														</div>




														<div style="margin-top:10px;font-weight:500;color:#000">

															<el-input :value="$validator.is(item.proprietarioCaptacao)? item.proprietarioCaptacao : 'não informado'" readonly>

																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer;" @click="()=>{item.acao=='abrir-proprietario'?  item.acao='fechar-proprietario' :  item.acao='abrir-proprietario';}">
																		Proprietário <i v-if="!item.validadoProprietario" title="dados inválidos" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:4px" class="fa fa-house-user"></i>
																	</div>
																</template>
																<template #append>
																	<div @click="()=>{item.acao=='abrir-proprietario'?  item.acao='fechar-proprietario' :  item.acao='abrir-proprietario';}" style="cursor:pointer;text-align:center">
																		<q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-proprietario'"></q-btn>
																		<q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
																	</div>
																</template>
															</el-input>
															<div v-if="item.acao=='abrir-proprietario'">
																<q-card>
																	<q-card-section>
																		<div style="line-height:30px;font-size:15px">
																			<el-row>
																				<el-col :xs="20" :md="10">
																					<el-row @keyup="UpdateProprietarioCaptacao(item)">
																						<el-col :md="24" class="s-input" style="margin:0px;padding:0px">
																							<div>NOME</div>
																							<el-input v-model="item.proprietario.nome" maxlength="80" input-style="text-transform:uppercase;"></el-input>
																						</el-col>
																						<el-col :md="24" class="s-input" style="margin:0px;padding:0px">
																							<div>E-MAIL</div>
																							<el-input v-model="item.proprietario.email" maxlength="80" input-style="text-transform:lowercase;"></el-input>
																						</el-col>
																						<el-col :md="24" class="s-input" style="margin:0px;padding:0px">
																							<div>TELEFONE 1</div>
																							<el-input v-model="item.proprietario.telefone" maxlength="80" input-style="text-transform:uppercase;" v-maska data-maska="(##) #####-#### ********************"></el-input>
																						</el-col>
																						<el-col :md="24" class="s-input" style="margin:0px;padding:0px">
																							<div>TELEFONE 2</div>
																							<el-input v-model="item.proprietario.telefone2" maxlength="80" input-style="text-transform:uppercase;" v-maska data-maska="(##) #####-#### ********************"></el-input>
																						</el-col>
																						<el-col :md="24" class="s-input" style="margin:0px;padding:0px">
																							<div>TELEFONE 3</div>
																							<el-input v-model="item.proprietario.telefone3" maxlength="80" input-style="text-transform:uppercase;" v-maska data-maska="(##) #####-#### ********************"></el-input>
																						</el-col>
																					</el-row>
																				</el-col>
																				<el-col :xs="2" :md="1"></el-col>
																				<el-col :xs="20" :md="10" style="line-height:40px" v-if="$validator.is(item.proprietarioCaptacao)">
																					<div v-if="$validator.is(item.proprietario.nome)" style="font-weight:500;color:var(--s-color-primary)"><i class="fa fa-user"></i> {{item.proprietario.nome}}</div>
																					<div v-if="$validator.is(item.proprietario.email)"><a :href="'mailto:'+item.proprietario.email" target="_blank" style="color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.proprietario.email}}</a> </div>
																					<div v-if="$validator.is(item.proprietario.telefone)"><a :href="$tools.BuildWhatsappLink(item.proprietario.telefone ,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.proprietario.telefone}}</a>   </div>
																					<div v-if="$validator.is(item.proprietario.telefone2)"><a :href="$tools.BuildWhatsappLink(item.proprietario.telefone2,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.proprietario.telefone2}}</a>  </div>
																					<div v-if="$validator.is(item.proprietario.telefone3)"><a :href="$tools.BuildWhatsappLink(item.proprietario.telefone3,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.proprietario.telefone3}}</a>  </div>
																				</el-col>
																			</el-row>
																		</div>
																	</q-card-section>
																</q-card>
															</div>
														</div>




														<div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
															<el-input v-model="item.url" readonly input-style="text-transform:lowercase;">
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenLink(item.url)">
																		URL    <i v-if="!item.validadaURL" title="URL inválida" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:10px" class="fa fa-link"></i>
																	</div>
																</template>
																<template #append>
																	<q-btn icon="fa fa-copy" flat @click="$tools.CopyLink(item.url)" style="width:10px" :title="item.url"></q-btn>
																	<q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenLink(item.url)"></q-btn>
																	<q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" @click="item.acao='abrir-url'" v-if="item.acao != 'abrir-url'"></q-btn>
																	<q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" @click="item.acao='fechar'" v-else></q-btn>
																</template>
															</el-input>
															<div v-if="item.acao=='abrir-url'">
																<q-card>
																	<q-card-section>
																		<el-input v-model="item.url" placeholder="" type="textarea" :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
																	</q-card-section>
																</q-card>
															</div>
														</div>


														<div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
															<el-input placeholder="" :value="$tools.BuildAddress(item)" readonly>
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenMap(item.url)">
																		Local   <i v-if="!item.validadoEndereco" title="endereço inválido" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:10px" class="fa fa-map-marker-alt"></i>
																	</div>
																</template>
																<template #append>
																	<q-btn icon="fa fa-copy" flat @click="$tools.Copy($tools.BuildAddress(item))" style="width:10px"></q-btn>
																	<q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenMap(item)"></q-btn>
																	<q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" @click="AbrirEdicaoEndereco(item)" v-if="item.acao != 'abrir-endereco'"></q-btn>
																	<q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" @click="item.acao='fechar'" v-else></q-btn>
																</template>
															</el-input>
															<div v-if="item.acao=='abrir-endereco'">
																<q-card>

																	<q-card-section>



																		<el-row :gutter="20">


																			<el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
																				<div><p>CEP</p><span></span></div>
																				<el-input v-model="cep.numero" placeholder="" ref="postalCode" v-maska data-maska="#####-###" @keyup="()=>{  if(cep.numero.length>=9){BuscarEndereco(item);} }">
																					<template #append>
																						<c-loading size="20px" v-if="carregandoCEP"></c-loading>
																						<i class="fa fa-search" v-else-if="(cep.numero.length < 9)" style="color:var(--s-accent-color)" @click="$tools.Alert('Preencha todo o CEP para poder realizar a busca.')"></i>
																						<i class="fa fa-search" v-else style="color:var(--s-accent-color);cursor:pointer" @click="BuscarEndereco"></i>
																					</template>
																				</el-input>
																			</el-col>



																			<el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
																				<div><p>ESTADO</p><span></span></div>
																				<div style="height:40px" v-if="carregandoEstados">
																					<c-loading size="30px" style="padding-left:5px"></c-loading>
																				</div>
																				<el-select v-else filterable v-model="item.estado" class="m-4" placeholder="Selecionar" size="large" style="width:100%" @change="(iitem)=>{ObterCidades(iitem,item);enableFilterButton = true;}">
																					<el-option v-for="iitem in opcoes.estados"
																							   :key="iitem.id"
																							   :label="iitem.label"
																							   :value="iitem.uf"></el-option>
																				</el-select>
																			</el-col>
																			<el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
																				<div><p>CIDADE</p><span></span></div>
																				<div style="height:40px" v-if="carregandoCidades">
																					<c-loading size="30px" style="padding-left:5px"></c-loading>
																				</div>
																				<el-select v-else v-model="item.cidade" filterable class="m-4" placeholder="Selecionar" size="large" style="width:100%" @click="()=>{ if($validator.not(item.estado)){ $tools.Alert('Selecione um <b>Estado</b> antes');} }" @change="(item)=>{ObterBairros(iitem,item);enableFilterButton = true;}">
																					<el-option v-for="iitem in opcoes.cidades"
																							   :key="iitem.id"
																							   :label="iitem.label"
																							   :value="iitem.nome"></el-option>
																				</el-select>
																			</el-col>
																			<el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
																				<div><p>BAIRRO</p><span></span></div>
																				<div style="height:40px" v-if="carregandoBairros">
																					<c-loading size="30px" style="padding-left:5px"></c-loading>
																				</div>
																				<el-select v-else v-model="item.bairro" filterable :clearable="true" class="m-4" placeholder="Selecionar" size="large" style="width:100%;" @click="()=>{ if($validator.not(item.estado)){ $tools.Alert('Selecione <b>Estado</b> e <b>Cidade</b> antes');} }" @change="(item)=>{DefinirBairro(iitem,item);enableFilterButton = true;}">
																					<el-option v-for="iitem in opcoes.bairros"
																							   :key="iitem.id"
																							   :label="iitem.label"
																							   :value="iitem.nome"></el-option>
																				</el-select>
																			</el-col>


																			<el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
																				<div>LOGRADOURO <span>&nbsp;rua, avenida, praça, etc</span></div>
																				<el-input @keyup.enter="Enviar()" v-model="item.logradouro" placeholder="" ref="logradouro" maxlength="80" input-style="text-transform:uppercase;"></el-input>
																			</el-col>
																			<el-col :xs="24" :sm="6" :md="4" :lg="4" class="s-input">
																				<div>NÚMERO <span><b>SN</b> se não houver</span></div>
																				<el-input @keyup.enter="Enviar()" v-model="item.numero" placeholder="" maxlength="80" input-style="text-transform:uppercase;" :ref="'endereconumero'+item.id"></el-input>
																			</el-col>

																			<el-col :xs="24" :sm="6" :md="4" :lg="4" class="s-input">
																				<div>COMPLEMENTO <span>&nbsp;&nbsp;opcional</span></div>
																				<el-input @keyup.enter="Enviar()" v-model="item.complemento" placeholder="" maxlength="80" input-style="text-transform:uppercase;"></el-input>
																			</el-col>

																		</el-row>
																	</q-card-section>
																</q-card>
															</div>
														</div>



														<div style="margin-top:10px;font-weight:500;color:#000">
															<el-input placeholder="" :value="ObterDataVisita(item)">
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenCalendar(item.dataVisita)">
																		Visita   <i style="padding-left:10px" class="fa fa-calendar" title="visita agendada"></i>
																	</div>
																</template>
																<template #append>
																	<q-btn icon="fa fa-copy" flat @click="()=>{ item.dataVisita.getFullYear() > 1900? $tools.Copy(item.dataVisita.format('dd/mm/yyyy, ddd, HH:MM\'h\'')) : $tools.MessageAlert('Data não especificada'); }" style="width:10px"></q-btn>
																	<q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenCalendar(item.dataVisita)"></q-btn>
																</template>
															</el-input>
														</div>



														<div style="margin-top:10px;font-weight:500;color:#000">
															<el-input placeholder="" :value="item.descricao">
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:700;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-descricao'?  item.acao='fechar-descricao' :  item.acao='abrir-descricao';}">
																		Descrição <i style="padding-left:10px" class="fa fa-message"></i>
																	</div>
																</template>
																<template #append>
																	<div @click="()=>{item.acao=='abrir-descricao'?  item.acao='fechar-descricao' :  item.acao='abrir-descricao';}" style="cursor:pointer;text-align:center">
																		<q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-descricao'"></q-btn>
																		<q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
																	</div>
																</template>
															</el-input>
															<div v-if="item.acao=='abrir-descricao'">
																<el-input v-model="item.descricao" placeholder="" type="textarea" readonly :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
															</div>
														</div>


														<div style="margin-top:10px;font-weight:500;color:#000">
															<el-input placeholder="" :value="item.avaliacao">
																<template #prepend>
																	<div style="text-transform:uppercase;font-weight:700;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-avaliacao'?  item.acao='fechar-avaliacao' :  item.acao='abrir-avaliacao';}">
																		Avaliação <i style="padding-left:10px" class="fa fa-house-circle-check"></i>
																	</div>
																</template>
																<template #append>
																	<div @click="()=>{item.acao=='abrir-avaliacao'?  item.acao='fechar-avaliacao' :  item.acao='abrir-avaliacao';}" style="cursor:pointer;text-align:center">
																		<q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-avaliacao'"></q-btn>
																		<q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
																	</div>
																</template>
															</el-input>
															<div v-if="item.acao=='abrir-avaliacao'">
																<el-input v-model="item.avaliacao" placeholder="" type="textarea" readonly :autosize="{ minRows: 3, maxRows: 5}" style="font-size:12pt"></el-input>
															</div>
														</div>


														<!--<div style="margin-top:10px;width:100%;text-align:center">
															<q-btn v-if="$root.usuario.gestor" label="REALOCAR" :color="item.idStatus==11? 'red':'teal'" text-color="white" @click="RealocarFinalizada(item)" :loading="item.acao=='realocar'" style="width:160px;margin-left:00px"></q-btn>
														</div>-->


													</div>

												</q-card-section>
											</q-card>





										</el-col>


								</div>



							</div>
						</div>
					</el-col>
				</el-row>


			</div>
		</div>
	</div>
</template>



<script>
	module.exports = {

        name: 'JCAdminParceiroSolicitacoes',

		data: function () {
			return {
				tab: "",
				view: "request",
				messageSuccess: "",
				messageAlert: "",
				content: "",
				idSolicitacao: null,
				carregandoCEP: false,
				carregandoEstados: false,
				carregandoCidades: false,
				carregandoBairros: false,
				cep: {
					numero: "",
					estado: "",
					cidade: "",
					logradouro: ""
				},
				opcoes: {
					estados: this.$root.localidade.estados,
					cidades: [],
					bairros: [],
					sexos: [],
				},
				admins: [],
				solicitacao: this.$models.solicitacao(),
				results: [],
				resultsAguardando: [],
				resultsVerificando: [],
				resultsFinalizadas: [],
				total: 0,
				totalAguardando: 0,
				totalVerificando: 0,
				totalFinalizadas: 0,
				cards: [],
				city: "",
				dataSelecionada: new Date(),
				dataSelecionadaFrom: new Date(),
				dataSelecionadaTo: new Date(),
                dataSelecionadaRange: { "from": "2024/05/05", "to": "2024/05/10" },
				admins: [],
				idAdminSelecionado: 0,
                status: [{value: 0,nome: "Todos"},{value: 3,nome: "Aguardando"},{value: 5,nome: "Verificando"},{value: 9,nome: "Finalizadas"},{value: 10,nome: "Encontradas"},{value: 11, nome: "Não encontradas" }],
                idStatusSelecionado: 0,
                busca: this.$models.busca(),
			}
		}, computed: {

		},

        props: {
            id: { type: Number, required: true, default: 0 },
        },
		watch: {
		},
		created: function () {

			this.busca.item = this.$models.solicitacao();

			this.ResetRangeDates();

			this.admins = (this.$root.admins.filter(a => !a.god && !a.gestor));
			this.admins.unshift({ id: 0, nome: "Todos", email: "" });
		},
		mounted() {

			//this.admins = this.$root.admins.filter(a => !a.god && !a.gestor);
			this.Enviar();

			//  window.setTimeout(() => this.UpdateChart(), 2000);

		},
		methods: {

			ResetRangeDates() {

                this.dataSelecionada = new Date();// this.$root.dataBackend;
                this.dataSelecionadaRange.to = this.$tools.FormatToQDate(this.dataSelecionada);

                this.dataSelecionadaFrom.setDate(this.dataSelecionada.getDate() - 5);
                this.dataSelecionadaRange.from = this.$tools.FormatToQDate(this.dataSelecionadaFrom);
			},


			ObterStatusClass(item) {
				var classcolor = "";
				if (item.agendado) {
					if (item.idStatus == 5)
						classcolor = 'bg-primary';
					else if (item.idStatus == 3) {
						if (item.horasDataConsiderada < 0)
							classcolor = 'bg-orange-6';
						if (item.horasDataConsiderada > 4)
							classcolor = 'bg-black';
						else if (item.horasDataConsiderada >= 2)
							classcolor = 'bg-red-9';
						else
							classcolor = 'bg-orange-9';
					} else
						classcolor = 'bg-orange-9';
				}
				else {
					if (item.idStatus == 5)
						classcolor = 'bg-primary';
					else if (item.idStatus == 3) {
						if (item.horasDataConsiderada < 0)
							classcolor = 'bg-orange-6';
						if (item.horasDataConsiderada > 24)
							classcolor = 'bg-black';
						else if (item.horasDataConsiderada >= 18)
							classcolor = 'bg-red-9';
						else
							classcolor = 'bg-orange-9';
					} else
						classcolor = 'bg-orange-9';
				}
				return classcolor;
			},


			ShowView(v) {
				this.view = v;
			},


			GetDateHourLabel(item) {
				var hoje = new Date();
				var dataItem = new Date(item.data);
				var label = "";
				var dias = Math.ceil(Math.abs(hoje - dataItem) / (1000 * 60 * 60 * 24));
				var diffHours = Math.ceil(Math.abs(hoje - dataItem) / (1000 * 60 * 60));
				var label = "";

				if (dias == 0)
					label = "<b>Hoje às " + dataItem.getHours() + ':' + dataItem.getMinutes() + "h</b> ( há " + diffHours + "h)";
				else
					label = "Há " + dias + " dias";
				//label += dataItem.getHours() + ':' + dataItem.getMinutes() + " há " + diffHours + "h";
				return label;
			},

			AbrirEdicaoEndereco(item) {
				this.cep.numero = item.cep;
				item.acao = 'abrir-endereco';
			},

			AbrirEdicaoAgenda(item) {
				var dt = this.agenda.data = this.agenda.hora = new Date(item.dataVisita);
				dt.setHours((this.agenda.hora.getHours()), this.agenda.hora.getMinutes(), 0, 0);
				this.agenda.hora.setHours(dt.getHours(), dt.getMinutes(), 0, 0);
				this.agenda.data.setHours(dt.getHours(), dt.getMinutes(), 0, 0);
				item.acao = 'abrir-agenda';
			},

			UpdateProprietarioCaptacao(item) {
				item.proprietarioCaptacao = this.$validator.is(item.proprietario.nome) ? (item.proprietario.nome.toUpperCase()) : "";
				item.proprietarioCaptacao += this.$validator.is(item.proprietario.email) ? (", " + item.proprietario.email) : "";
				item.proprietarioCaptacao += this.$validator.is(item.proprietario.telefone) ? (", " + item.proprietario.telefone) : "";
				item.proprietarioCaptacao += this.$validator.is(item.proprietario.telefone2) ? (", " + item.proprietario.telefone2) : "";
				item.proprietarioCaptacao += this.$validator.is(item.proprietario.telefone3) ? (", " + item.proprietario.telefone3) : "";
			},

			ObterDataVisita(item) {
				if (this.$validator.is(item.dataVisita)) {
					var data = item.dataVisita;
					//return data.format("dd/mm/yyyy, ddd, HH:MM'h'");
					return (data.getFullYear() > 1900) ? data.format("dd/mm/yyyy, ddd, HH:MM'h'") : "sem visita agendada";
				}
				return "";
			},


			UpdateChart() {
				// window.setTimeout(() => this.$refs.distribuicao.BuildChart(this.resultsAguardando, this.resultsVerificando, this.resultsFinalizadas, 1000));
			},


			async Enviar() {

                this.busca.item.idParceiro = this.id;
				this.busca.item.id = 0;

				if (this.$validator.is(this.idSolicitacao))
					this.busca.item.id = this.$validator.IsInt(this.idSolicitacao) ? this.idSolicitacao : 0;

				this.busca.item.idStatus = this.idStatusSelecionado;
				this.busca.item.idAdmin  = this.idAdminSelecionado;

                if (this.$validator.is(this.dataSelecionadaRange?.from)){
					this.busca.item.data= this.$tools.FormatFromQDate(this.dataSelecionadaRange.to);
					this.busca.dateFrom	= this.$tools.FormatFromQDate(this.dataSelecionadaRange.from);
					this.busca.dateTo	= this.$tools.FormatFromQDate(this.dataSelecionadaRange.to);
                } else if (this.$validator.is(this.dataSelecionadaRange)){
					this.busca.item.data= this.$tools.FormatFromQDate(this.dataSelecionadaRange);
					this.busca.dateFrom = new Date(1900,1,1);
					this.busca.dateTo = this.$tools.FormatFromQDate(this.dataSelecionadaRange);
				} else{
					this.ResetRangeDates();
					this.busca.item.data= this.$tools.FormatFromQDate(this.dataSelecionadaRange.to);
					this.busca.dateFrom	= this.$tools.FormatFromQDate(this.dataSelecionadaRange.from);
					this.busca.dateTo	= this.$tools.FormatFromQDate(this.dataSelecionadaRange.to);

				}
                c2("this.busca.dateFro ", this.busca.dateFrom);

				this.view = "request";

				var request = await this.$api.Post("solicitacao/buscarrange", this.busca);

				if (request.status.success) {

					this.total = request.result.total;
					this.results = request.result.result;

					this.results.forEach(i => {
                        i.data              = this.$tools.DateFix(i.data             );
                        i.dataVisita        = this.$tools.DateFix(i.dataVisita       );
                        i.dataAgendamento   = this.$tools.DateFix(i.dataAgendamento  );
                        i.dataReagendamento = this.$tools.DateFix(i.dataReagendamento);
                        i.dataConfirmado    = this.$tools.DateFix(i.dataConfirmado   );
                        i.dataVisitado      = this.$tools.DateFix(i.dataVisitado     );
                        i.dataConcluido     = this.$tools.DateFix(i.dataConcluido    );
						i.agendado = (i.dataVisita.getFullYear() > 2000);
						i.acaocard = 'fechar-card' + i.id;
						// i.proprietarioCaptacao = "Teste, (11) 98498-4894, paulogneto@gmail.com";
						if (this.$validator.is(i.proprietarioCaptacao)) {
							var fields = i.proprietarioCaptacao.split(",");
							i.proprietario.nome = this.$validator.is(fields[0]) ? fields[0] : null;
							i.proprietario.email = this.$validator.is(fields[1]) ? fields[1] : null;
							i.proprietario.telefone = this.$validator.is(fields[2]) ? fields[2] : null;
							i.proprietario.telefone2 = this.$validator.is(fields[3]) ? fields[3] : null;
							i.proprietario.telefone3 = this.$validator.is(fields[4]) ? fields[4] : null;
						}
					});

					this.tab = (this.$root.usuario.god || this.$root.usuario.gestor) ? "distribuicao" : "aguardando";
					//this.tab = "aguardando";
					//window.setTimeout(() => { this.UpdateChart(); }, 2000);
					this.view = "success";

				}//else
				//  this.view = "fail";





			},




			async Captar(item) {
				item.acao = 'captar';
				var request = await this.$api.Post("solicitacao/captar", item);
				if (request?.status?.success) {
					item.acao = 0;
					//this.$tools.AlertSuccess("Solicitação ID# " + item.id + " captada em verificação!");
					this.$tools.MessageSuccess("Solicitação ID# " + item.id + " captada em verificação!");
					request.result.dataVisita = new Date(request.result.dataVisita);
					request.result.acaocard = 'abrir-card' + request.result.id;
					this.resultsVerificando.unshift(request.result);
					this.totalAguardando--;
					this.totalVerificando++;
					item.ativo = false;
					this.tab = "verificando";
					this.$tools.Top();
					window.setTimeout(() => this.$refs["avaliacao" + item.id].focus(), 500);
					//c(this.results);
				}//else
				//  this.view = "fail";
			},

			async Reavaliar(item) {
				item.acao = 'reavaliar';
				var request = await this.$api.Post("solicitacao/captar", item);
				if (request?.status?.success) {
					item.acao = 0;
					//this.$tools.AlertSuccess("Solicitação ID# " + item.id + " captada em verificação!");
					this.$tools.MessageSuccess("Solicitação ID# " + item.id + " captada em verificação!");
					request.result.dataVisita = new Date(request.result.dataVisita);
					request.result.acaocard = 'abrir-card' + request.result.id;
					this.resultsVerificando.unshift(request.result);
					this.totalFinalizadas--;
					this.totalVerificando++;
					window.setTimeout(() => this.$refs["avaliacao" + request.result.id].focus(), 500);
					item.ativo = false;
					this.tab = "verificando";
					this.$tools.Top();
					//c(this.results);
				}//else
				//  this.view = "fail";
			},

			async Realocar(item) {
				item.acao = 'realocar';
				var request = await this.$api.Post("solicitacao/realocar", item);
				if (request?.status?.success) {
					item.acao = request.result.acao = 0;
					this.$tools.AlertSuccess("Solicitação ID# " + item.id + " foi realocada para admin <br><b>id#" + request.result.admin.id + "  " + request.result.admin.nome + "</b><br> em AGUARDANDO.");
					request.result.dataVisita = new Date(request.result.dataVisita);
					this.resultsAguardando.unshift(request.result);
					this.totalVerificando--;
					this.totalAguardando++;
					//this.resultsVerificando = this.results.filter(r => r.id != item.id && r.idStatus == 5);
					//this.resultsFinalizadas = this.results.filter(r => r.id != item.id && r.idStatus == 9);
					item.ativo = false;
					//c(this.results);
				}//else
				//  this.view = "fail";
			},

			async RealocarFinalizada(item) {
				item.acao = 'realocar';
				var request = await this.$api.Post("solicitacao/realocar", item);
				if (request?.status?.success) {
					item.acao = request.result.acao = 0;
					this.$tools.AlertSuccess("Solicitação ID# " + item.id + " foi realocada para admin <br><b>id#" + request.result.admin.id + "  " + request.result.admin.nome + "</b><br> em aguardando.");
					request.result.dataVisita = new Date(request.result.dataVisita);
					this.resultsAguardando.unshift(request.result);
					this.totalFinalizadas--;
					this.totalAguardando++;
					//this.resultsVerificando = this.results.filter(r => r.id != item.id && r.idStatus == 5);
					//this.resultsFinalizadas = this.results.filter(r => r.id != item.id && r.idStatus == 9);
					item.ativo = false;
					//c(this.results);
				}//else
				//  this.view = "fail";
			},

			async Cancelar(item) {
				item.acao = 'cancelar';
				var request = await this.$api.Post("solicitacao/cancelar", item);
				if (request?.status?.success) {
					item.acao = request.result.acao = 0;
					this.$tools.AlertSuccess("Solicitação ID# " + item.id + " voltou para o status de aguardada.");
					request.result.dataVisita = new Date(request.result.dataVisita);
					this.resultsAguardando.unshift(request.result);
					this.totalVerificando--;
					this.totalAguardando++;
					//this.resultsVerificando = this.results.filter(r => r.id != item.id && r.idStatus == 5);
					//this.resultsFinalizadas = this.results.filter(r => r.id != item.id && r.idStatus == 9);
					item.ativo = false;
					//c(this.results);
				}//else
				//  this.view = "fail";
			},

			async Alterar(item) {
				item.acao = 'alterar';
				var request = await this.$api.Post("solicitacao/alterar", item);
				item.acao = 0;
				if (request?.status?.success) {
					item = request.result;
					item.dataVisita = new Date(item.dataVisita);
					item.acao = 0;
					this.$tools.AlertSuccess("Solicitação ID# " + item.id + " salva!");
					//c(this.results);
				}//else
				//  this.view = "fail";
			},


			async FinalizarComoLocalizado(item) {
				item.idStatus = 10;
				item.status = "Localizado";
				this.Finalizar(item);
			},

			async FinalizarComoNaoLocalizado(item) {
				item.idStatus = 11;
				item.status = "Não localizado";
				this.Finalizar(item);
			},

			async Finalizar(item) {
				item.acao = 'finalizar';
				var request = await this.$api.Post("solicitacao/finalizar", item);
				if (request?.status?.success) {
					item.acao = 0;
					this.$tools.AlertSuccess("Solicitação ID# " + item.id + " finalizada!");
					request.result.dataVisita = new Date(request.result.dataVisita);
					this.resultsFinalizadas.unshift(request.result);
					this.totalVerificando--;
					this.totalFinalizadas++;
					item.ativo = false;
					//c(this.results);
				}//else
				//  this.view = "fail";
			},


/*
			async BuscarEndereco(item) {

				if (this.cep.numero !== item.cep) {

					this.carregandoCEP = true;
					this.carregandoEstados = true;
					this.carregandoCidades = true;
					this.carregandoBairros = true;

					this.cep.cidade = item.cidade = "";
					this.cep.logradouro = item.logradouro = "";
					this.cep.bairro = item.bairro = "";
					this.cep.estado = item.estado = "";

					item.cep = this.cep.numero;
					let res = await this.$sdata.BuscarEndereco(this.cep.numero);

					if (this.$validator.is(res?.city)) {
						this.cep.cidade = item.cidade = res.city;
						this.cep.logradouro = item.logradouro = res.address;
						this.cep.bairro = item.bairro = res.neighborhood;
						this.cep.estado = item.estado = res.state;
					}

					this.carregandoCEP = false;
					this.carregandoEstados = false;
					this.carregandoCidades = false;
					this.carregandoBairros = false;

					this.$refs["endereconumero" + item.id].focus();
				}
			},

			async BuscarCep(item) {
				var endereco = item.estado + "/" + item.cidade.replaceAll(" ", "%20") + "/" + item.logradouro.replaceAll(" ", "%20")
				let res = await this.$sdata.BuscarCep(endereco);
				return res.cep;
			},



			ObterCidades(estado, item) {

				item.cidade = item.bairro = "";
				item.idCidade = item.idBairro = 0;

				this.opcoes.bairros = [];
				this.opcoes.cidades = [];
				var cidades = [];

				if (this.$validator.is(estado)) {
					this.carregandoCidades = true;
					item.idEstado = this.opcoes.estados.filter((e) => e.uf == estado)[0].id;
					this.$sdata.ObterCidades(item.idEstado).then(res => { this.carregandoCidades = false; this.opcoes.cidades = res; });
				}

			},


			ObterBairros(cidade, item) {

				item.bairro = "";
				item.idBairro = 0;

				this.opcoes.bairros = [];
				var bairros = [];

				if (this.$validator.is(cidade)) {
					this.carregandoBairros = true;
					item.idCidade = this.opcoes.cidades.filter((c) => c.nome == cidade)[0].id;
					this.$sdata.ObterBairros(item.idCidade).then(res => { this.carregandoBairros = false; this.opcoes.bairros = res; });
				}

			},

			DefinirBairro(bairro, item) {
				item.idBairro = this.opcoes.bairros.filter((c) => c.nome == bairro)[0].id;
				//this.$refs.logradouro.focus();
				//this.busca.item.bairro = bairro.label;
				//c2("this.busca.item", this.busca.item);
			},

*/



			FormatarDataVisita(item) {

				var dia = null;
				var hora = null;

				if (this.$validator.is(this.agenda.data)) {
					dia = new Date(this.agenda.data);
					item.dataVisita = new Date(dia.toUTCString());

					if (this.$validator.not(this.agenda.hora))
						this.agenda.hora = new Date(1900, 0, 1, 16, 0, 0, 0);

					hora = new Date(this.agenda.hora);
					dia.setHours((hora.getHours()), hora.getMinutes(), 0, 0);
					//this.dataVisitaLabel = dia.format("dd/mm/yyyy, HH:MM'h'");

				} else {
					item.dataVisita = new Date(1900, 0, 1, 0, 0, 0, 0);
					//this.dataVisitaLabel = "";
					this.agenda.hora = null;
				}


				if (this.$validator.is(this.agenda.hora)) {

					hora = new Date(this.agenda.hora);
					item.dataVisita.setHours(hora.getHours(), hora.getMinutes(), 0, 0);
					//item.dataVisita.setHours((hora.getHours() - 3), hora.getMinutes(), 0, 0);

					dia.setHours((hora.getHours()), hora.getMinutes(), 0, 0);
					//this.dataVisitaLabel = dia.format("dd/mm/yyyy, ddd, HH:MM'h'");
				}


			},






		}

	}

</script>


<style scoped>

	.s-input {
		margin-bottom: 10px !important;
	}

	.el-input__inner {
		font-size: 13px;
	}

	input-group__prepend {
		font-size: 12px;
	}

	.el-input-group__prepend {
		font-size: 12px;
	}

</style>


