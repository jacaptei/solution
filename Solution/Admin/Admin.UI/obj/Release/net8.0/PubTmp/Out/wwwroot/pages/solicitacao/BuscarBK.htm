<template>

    <div class="row">
        <div class="col-12">



            <q-tabs v-model="tab"
                    dense
                    no-caps
                    align="left"
                    narrow-indicator
                    class="text-grey"
                    active-color="primary"
                    indicator-color="primary">
                <!--<q-tab name="relatorio"     icon="fa fa-chart-bar"      label="DISTRIBUIÇÃO" v-if="$root.usuario.god || $root.usuario.gestor"></q-tab>-->
                <q-tab name="aguardando"    icon="fa fa-list"           label="AGUARDANDO"></q-tab>
                <q-tab name="verificando"   icon="fa fa-gear"           label="EM VERIFICAÇÃO"></q-tab>
                <q-tab name="finalizadas"   icon="fa fa-check"          label="FINALIZADAS"></q-tab>
            </q-tabs>

            <el-row :gutter="20" v-if="view == 'request' ">
                <el-col :md="24">
                    <c-loading></c-loading>
                </el-col>
            </el-row>
            <el-row :gutter="20" v-else-if="view == 'fail' ">
                <el-col :md="24" style="width:100%;text-align:center;padding:40px;padding-left:0px">
                    <div class="title" style="color:var(--s-color-red)"><b><i class="fa fa-circle-xmark"></i> Falhou</b></div>
                    <br />Não foi possível obter solicitações,<br />favor tentar novamente.
                    <br /><br />
                    <q-btn color="white" text-color="orange-10" label="VOLTAR" @click="ShowView('form')" style="width:200px;"></q-btn>
                </el-col>
            </el-row>
            
            <q-tab-panels v-model="tab" animated v-else>


                <q-tab-panel name="relatorio">
                    <div>
                        <page_relatorio></page_relatorio>
                    </div>
                </q-tab-panel>




                <q-tab-panel name="aguardando">
                    <div>

                        <el-row :gutter="20">

                            <!--<el-col :md="24" style="width:100%;text-align:center;padding:40px;padding-left:0px" v-if="totalAguardando == 0">
                                <i class="fa fa-circle-exclamation" style="font-size:80px;color:var(--s-color-primary)"></i>  <br />
                                <div style="font-size:20px;font-weight:700;color:var(--s-color-primary);margin-top:20px">Sem solicitações em verificação.</div>
                            </el-col>-->

                            <div>
                                <div style="color:var(--s-color-primary);font-weight:700;height:40px;padding-left:12px;float:left;width:120px">{{totalAguardando}} <span v-if="totalAguardando == 1">solicitação</span><span v-else>solicitações</span></div>
                                <div style="float:right">
                                    <el-select v-model="idAdminSelecionado" filterable placeholder="Todos" size="small" style="width:100%" @change="(aditem)=>{FiltrarAguardando(aditem)}">
                                    <el-option :key="0" label="Todos" value="0"></el-option>
                                            <el-option v-for="aditem in $root.admins"
                                                       :key="aditem.id"
                                                       :label="aditem.nome"
                                                       :value="aditem.id"></el-option>
                                            </el-select>
                                </div>

                            </div>

                            <el-col v-if="totalAguardando > 0" :md="24" v-for="(item,index) in resultsAguardando">


                                <q-card style="width:100%;color:#fff;margin-bottom:5px" v-if="item.ativo">
                                    <q-card-section style="cursor:pointer" @click="()=>{item.acaocard==('abrir-card'+item.id)?  item.acaocard=('fechar-card'+item.id) :  item.acaocard=('abrir-card'+item.id);}" :class="item.horas > 4?  'bg-black' :  item.horas >= 2?  'bg-red-9' :  item.idStatus == 3? 'bg-orange-9' : item.idStatus == 5? 'bg-primary' : 'bg-teal' ">
                                        <div class="text-h10">
                                            <span class="text-h10">
                                                <b style="margin-right:10px;">#ID {{item.id}}</b> {{$tools.FormatDayToBR(item.data)}} {{$tools.GetDayWeek(item.data)}} {{$tools.GetHours(item.data)}}h
                                                <i v-if="!item.validadoProprietario|| !item.validadaURL || !item.validadoEndereco" title="há dados invalidados" style="padding-left:4px;color:#fff;font-size:20px;" class="fa fa-warning"></i>
                                            </span>
                                            <span class="text-h10">
                                                <span style="float:right">
                                                    <!--<span v-if="item.idStatus == 3">AGUARDANDO CAPTADOR</span>
                                                    <span v-if="item.idStatus == 5">EM VERIFICAÇÃO</span>
                                                    <span v-if="item.idStatus == 9">FINALIZADO</span>-->
                                                    <span style="font-weight:600;font-size:17px">
                                                        <span v-if="item.horas == 0">há {{item.minutos}}min</span>
                                                        <span v-else-if="item.dias == 0">há {{item.horas}}h</span>
                                                        <span v-else-if="item.dias == 1">Ontem às {{$tools.GetHours(item.data)}}h</span>
                                                        <span v-else>Há {{item.dias}} dias</span>
                                                    </span>
                                                    <span style="margin-left:15px;">
                                                        <i class="fa fa-caret-down" v-if="item.acaocard != ('abrir-card'+item.id)"></i>
                                                        <i class="fa fa-caret-up" v-else></i>
                                                    </span>
                                                </span>
                                            </span>
                                        </div>
                                    </q-card-section>

                                    <q-card-section :id="'content'+item.id" v-if="item.acaocard==('abrir-card'+item.id)" style="margin-bottom:15px">

                                        <div>



                                            <div style="font-weight:500;color:#000;margin-bottom:10px">
                                                <el-input :value="'Admin #'+item.admin.id + ', '+item.admin.nome" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right">
                                                            Admin   <i style="padding-left:10px" class="fa fa-user-gear"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div style="width:50px;text-align:center">
                                                            <b></b>
                                                        </div>
                                                    </template>
                                                </el-input>
                                            </div>


                                            <div style="font-weight:500;color:#000">

                                                <el-input :value="$validator.is(item.parceiro)? ('#'+item.parceiro.id + ', '+item.parceiro.apelido + ', '+item.parceiro.telefone + ', '+item.parceiro.email) : 'não informado'" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-parceiro'?  item.acao='fechar-parceiro' :  item.acao='abrir-parceiro';}">
                                                            Parceiro  <i style="padding-left:10px" class="fa fa-user-alt"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div @click="()=>{item.acao=='abrir-parceiro'?  item.acao='fechar-parceiro' :  item.acao='abrir-parceiro';}" style="cursor:pointer;width:50px;text-align:center">
                                                            <q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-parceiro'"></q-btn>
                                                            <q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-parceiro'">
                                                    <q-card>
                                                        <q-card-section>
                                                            <div style="line-height:30px;font-size:15px">
                                                                <div style="font-weight:500;color:var(--s-color-primary)">#id {{item.parceiro.id}}</div>
                                                                <div style="font-weight:500;color:var(--s-color-primary)">{{item.parceiro.nome}}</div>
                                                                <div><a :href="$tools.BuildWhatsappLink(item.parceiro.telefone,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.parceiro.telefone}}</a>                                    </div>
                                                                <div v-if="$validator.IsCPF(item.parceiro.cpf)"><a href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cpf)" style="text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="text-decoration:none"></i>CPF: {{item.parceiro.cpf}}  </a>       </div>
                                                                <div v-else-if="$validator.IsCNPJ(item.parceiro.cnpj)"><a href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cnpj)" style="text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="text-decoration:none"></i>CNPJ: {{item.parceiro.cnpj}}  </a>     </div>
                                                                <div><a :href="'mailto:'+item.parceiro.email" target="_blank" style="color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.parceiro.email}}</a>                                                                                              </div>
                                                            </div>
                                                        </q-card-section>
                                                    </q-card>
                                                </div>
                                            </div>




                                            <div style="margin-top:10px;font-weight:500;color:#000">

                                                <el-input :value="$validator.is(item.proprietarioCaptacao)? (item.proprietario.nome + ', '+item.proprietario.telefone + ', '+item.proprietario.email) : 'não informado'" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer;" @click="()=>{item.acao=='abrir-proprietario'?  item.acao='fechar-proprietario' :  item.acao='abrir-proprietario';}">
                                                            Proprietário  <i v-if="!item.validadoProprietario" title="dados inválidos" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:4px" class="fa fa-house-user"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div @click="()=>{item.acao=='abrir-proprietario'?  item.acao='fechar-proprietario' :  item.acao='abrir-proprietario';}" style="cursor:pointer;width:50px;text-align:center">
                                                            <q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-proprietario'"></q-btn>
                                                            <q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-proprietario'">
                                                    <q-card>
                                                        <q-card-section>
                                                            <div style="line-height:30px;font-size:15px" v-if="$validator.is(item.proprietario?.nome)">
                                                                <div style="font-weight:500;color:var(--s-color-primary)">{{item.proprietario.nome}}</div>
                                                                <div><a :href="$tools.BuildWhatsappLink(item.proprietario.telefone,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.proprietario.telefone}}</a>                                    </div>
                                                                <div><a :href="'mailto:'+item.proprietario.email" target="_blank" style="color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.proprietario.email}}</a>                                                                                              </div>
                                                            </div>
                                                        </q-card-section>
                                                    </q-card>
                                                </div>

                                            </div>




                                            <div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
                                                <el-input v-model="item.url" readonly input-style="text-transform:lowercase;">
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenLink(item.url)">
                                                            URL    <i v-if="!item.validadaURL" title="dado inválido" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:10px" class="fa fa-link"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div style="width:50px;text-align:right">
                                                            <q-btn icon="fa fa-copy" flat @click="$tools.CopyLink(item.url)" style="width:10px" :title="item.url"></q-btn>
                                                            <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenLink(item.url)"></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                            </div>


                                            <div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
                                                <el-input placeholder="" :value="$tools.BuildAddress(item)" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenMap(item.url)">
                                                            Local   <i v-if="!item.validadoEndereco" title="dados inválidos" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:10px" class="fa fa-map-marker-alt"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div style="width:50px;text-align:right">
                                                            <q-btn icon="fa fa-copy" flat @click="$tools.Copy($tools.BuildAddress(item))" style="width:10px"></q-btn>
                                                            <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenMap(item)"></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                            </div>




                                            <div style="margin-top:10px;font-weight:500;color:#000">
                                                <el-input placeholder="" :value="ObterDataVisita(item)">
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenCalendar(item.dataVisita)">
                                                            Visita   <i style="padding-left:10px" class="fa fa-calendar" title="visita agendada"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div style="width:50px;text-align:right">
                                                            <q-btn icon="fa fa-copy" flat @click="()=>{ item.dataVisita.getFullYear() > 1900? $tools.Copy(item.dataVisita.format('dd/mm/yyyy, ddd, HH:MM\'h\'')) : $tools.MessageAlert('Data não especificada'); }" style="width:10px"></q-btn>
                                                            <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenCalendar(item.dataVisita)"></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                            </div>



                                            <div style="margin-top:10px;font-weight:500;color:#000">
                                                <el-input placeholder="" :value="item.descricao">
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:700;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-descricao'?  item.acao='fechar-descricao' :  item.acao='abrir-descricao';}">
                                                            Descrição <i style="padding-left:10px" class="fa fa-message"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div @click="()=>{item.acao=='abrir-descricao'?  item.acao='fechar-descricao' :  item.acao='abrir-descricao';}" style="cursor:pointer;width:50px;text-align:center">
                                                            <q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-descricao'"></q-btn>
                                                            <q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-descricao'">
                                                    <el-input v-model="item.descricao" placeholder="" type="textarea" readonly :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
                                                </div>
                                            </div>

                                            <div style="margin-top:10px;width:100%;text-align:center">
                                                <q-btn label="CAPTAR" text-color="white" @click="Captar(item)" :loading="item.acao=='captar'" style="width:160px;margin-left:00px" :color="item.horas >= 4?  'black' :  item.horas >= 2?  'red-9' :  item.idStatus == 3? 'orange-9' : item.idStatus == 5? 'primary' : 'teal' "></q-btn>
                                            </div>


                                        </div>

                                    </q-card-section>
                                </q-card>





                            </el-col>


                    </div>
                </q-tab-panel>






                <q-tab-panel name="verificando">
                    <div>

                        <el-row :gutter="20">

                            <el-col :md="24" style="width:100%;text-align:center;padding:40px;padding-left:0px" v-if="totalVerificando == 0">
                                <i class="fa fa-circle-exclamation" style="font-size:80px;color:var(--s-color-primary)"></i>  <br />
                                <div style="font-size:20px;font-weight:700;color:var(--s-color-primary);margin-top:20px">Sem solicitações em verificação.</div>
                            </el-col>

                            <div v-if="totalVerificando > 0" style="color:var(--s-color-primary);font-weight:700;height:40px;padding-left:12px;">{{totalVerificando}} <span v-if="totalVerificando == 1">solicitação</span><span v-else>solicitações</span></div>

                            <el-col v-if="totalVerificando > 0" :md="24" v-for="(item,index) in resultsVerificando">


                                <q-card style="width:100%;color:#fff;margin-bottom:5px" v-if="item.ativo">
                                    <q-card-section style="cursor:pointer" @click="()=>{item.acaocard==('abrir-card'+item.id)?  item.acaocard=('fechar-card'+item.id) :  item.acaocard=('abrir-card'+item.id);}" :class="item.idStatus == 3? 'bg-yellow-9' : item.idStatus == 5? 'bg-primary' : 'bg-teal' ">
                                        <div class="text-h10">
                                            <span class="text-h10">
                                                <b style="margin-right:10px;">#ID {{item.id}}</b> {{$tools.FormatDayToBR(item.data)}} {{$tools.GetDayWeek(item.data)}} {{$tools.GetHours(item.data)}}h
                                                <i v-if="!item.validadoProprietario|| !item.validadaURL || !item.validadoEndereco" title="há dados invalidados" style="padding-left:4px;color:#ffff00;font-size:20px;" class="fa fa-warning"></i>
                                            </span>
                                            <span class="text-h10">
                                                <span style="float:right">
                                                    <span style="margin-left:15px;">
                                                        <i class="fa fa-caret-down" v-if="item.acaocard != ('abrir-card'+item.id)"></i>
                                                        <i class="fa fa-caret-up" v-else></i>
                                                    </span>
                                                </span>
                                            </span>
                                        </div>
                                    </q-card-section>

                                    <q-card-section :id="'content'+item.id" v-if="item.acaocard==('abrir-card'+item.id)" style="margin-bottom:15px">

                                        <div>





                                            <div style="font-weight:500;color:#000;margin-bottom:10px">
                                                <el-input :value="'Admin #'+item.admin.id + ', '+item.admin.nome" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right">
                                                            Admin   <i style="padding-left:10px" class="fa fa-user-gear"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div style="width:50px;text-align:center">
                                                            <b></b>
                                                        </div>
                                                    </template>
                                                </el-input>
                                            </div>



                                            <div style="font-weight:500;color:#000">

                                                <el-input :value="'#'+item.parceiro.id + ', '+item.parceiro.apelido + ', '+item.parceiro.telefone + ', '+item.parceiro.email" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-parceiro'?  item.acao='fechar-parceiro' :  item.acao='abrir-parceiro';}">
                                                            Parceiro  <i style="padding-left:10px" class="fa fa-user-alt"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div @click="()=>{item.acao=='abrir-parceiro'?  item.acao='fechar-parceiro' :  item.acao='abrir-parceiro';}" style="cursor:pointer;text-align:center">
                                                            <q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-parceiro'"></q-btn>
                                                            <q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-parceiro'">
                                                    <q-card>
                                                        <q-card-section>
                                                            <div style="line-height:30px;font-size:15px">
                                                                <div style="font-weight:500;color:var(--s-color-primary)">#id {{item.parceiro.id}}</div>
                                                                <div style="font-weight:500;color:var(--s-color-primary)">{{item.parceiro.nome}}</div>
                                                                <div><a :href="$tools.BuildWhatsappLink(item.parceiro.telefone,'Olá '+item.apelido)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.parceiro.telefone}}</a>                                    </div>
                                                                <div v-if="$validator.IsCPF(item.parceiro.cpf)"><a href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cpf)" style="text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="text-decoration:none"></i>CPF: {{item.parceiro.cpf}}  </a>       </div>
                                                                <div v-else-if="$validator.IsCNPJ(item.parceiro.cnpj)"><a href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cnpj)" style="text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="text-decoration:none"></i>CNPJ: {{item.parceiro.cnpj}}  </a>     </div>
                                                                <div><a :href="'mailto:'+item.parceiro.email" target="_blank" style="color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.parceiro.email}}</a>                                                                                              </div>
                                                            </div>
                                                        </q-card-section>
                                                    </q-card>
                                                </div>
                                            </div>




                                            <div style="margin-top:10px;font-weight:500;color:#000">

                                                <el-input :value="$validator.is(item.proprietarioCaptacao)? (item.proprietario.nome + ', '+item.proprietario.telefone + ', '+item.proprietario.email) : 'não informado'" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer;" @click="()=>{item.acao=='abrir-proprietario'?  item.acao='fechar-proprietario' :  item.acao='abrir-proprietario';}">
                                                            Proprietário <i v-if="!item.validadoProprietario" title="dados inválidos" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:4px" class="fa fa-house-user"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div @click="()=>{item.acao=='abrir-proprietario'?  item.acao='fechar-proprietario' :  item.acao='abrir-proprietario';}" style="cursor:pointer;text-align:center">
                                                            <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-proprietario'"></q-btn>
                                                            <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" v-else></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-proprietario'">
                                                    <q-card>
                                                        <q-card-section>
                                                            <div style="line-height:30px;font-size:15px">
                                                                <el-row>
                                                                    <el-col :xs="20" :md="10">
                                                                        <el-row @keyup="UpdateProprietarioCaptacao(item)">
                                                                            <el-col :md="24" class="s-input" style="margin:0px;padding:0px">
                                                                                <div>NOME</div>
                                                                                <el-input v-model="item.proprietario.nome" maxlength="80" input-style="text-transform:uppercase;"></el-input>
                                                                            </el-col>

                                                                            <el-col :md="24" class="s-input" style="margin:0px;padding:0px">
                                                                                <div>TELEFONE</div>
                                                                                <el-input v-model="item.proprietario.telefone" maxlength="80" input-style="text-transform:uppercase;" v-maska data-maska="(##) #####-#### ********************"></el-input>
                                                                            </el-col>
                                                                            <el-col :md="24" class="s-input" style="margin:0px;padding:0px">
                                                                                <div>E-MAIL</div>
                                                                                <el-input v-model="item.proprietario.email" maxlength="80" input-style="text-transform:lowercase;"></el-input>
                                                                            </el-col>
                                                                        </el-row>
                                                                    </el-col>
                                                                    <el-col :xs="2" :md="1"></el-col>
                                                                    <el-col :xs="20" :md="10" style="line-height:40px" v-if="$validator.is(item.proprietarioCaptacao)">
                                                                        <div style="font-weight:500;color:var(--s-color-primary)">{{item.proprietario.nome}}</div>
                                                                        <div><a :href="$tools.BuildWhatsappLink(item.proprietario.telefone,'Olá '+item.proprietario.nome)" target="_blank" style="color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp"></i> {{item.proprietario.telefone}}</a>                                    </div>
                                                                        <div><a :href="'mailto:'+item.proprietario.email" target="_blank" style="color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.proprietario.email}}</a>                                                                                              </div>
                                                                    </el-col>
                                                                </el-row>
                                                                <div> <el-checkbox v-model="item.validadoProprietario" label="proprietário válido"></el-checkbox></div>
                                                            </div>
                                                        </q-card-section>
                                                    </q-card>
                                                </div>
                                            </div>




                                            <div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
                                                <el-input v-model="item.url" readonly input-style="text-transform:lowercase;">
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenLink(item.url)">
                                                            URL    <i v-if="!item.validadaURL" title="URL inválida" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:10px" class="fa fa-link"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <q-btn icon="fa fa-copy" flat @click="$tools.CopyLink(item.url)" style="width:10px" :title="item.url"></q-btn>
                                                        <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenLink(item.url)"></q-btn>
                                                        <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" @click="item.acao='abrir-url'" v-if="item.acao != 'abrir-url'"></q-btn>
                                                        <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" @click="item.acao='fechar'" v-else></q-btn>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-url'">
                                                    <q-card>
                                                        <q-card-section>
                                                            <el-input v-model="item.url" placeholder="" type="textarea" :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
                                                            <div> <el-checkbox v-model="item.validadaURL" label="URL válida"></el-checkbox></div>
                                                        </q-card-section>
                                                    </q-card>
                                                </div>
                                            </div>


                                            <div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
                                                <el-input placeholder="" :value="$tools.BuildAddress(item)" readonly>
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenMap(item.url)">
                                                            Local   <i v-if="!item.validadoEndereco" title="endereço inválido" style="padding-left:4px;color:#ff0000;font-size:17px;" class="fa fa-warning"></i><i v-else style="padding-left:10px" class="fa fa-map-marker-alt"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <q-btn icon="fa fa-copy" flat @click="$tools.Copy($tools.BuildAddress(item))" style="width:10px"></q-btn>
                                                        <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenMap(item)"></q-btn>
                                                        <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" @click="AbrirEdicaoEndereco(item)" v-if="item.acao != 'abrir-endereco'"></q-btn>
                                                        <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" @click="item.acao='fechar'" v-else></q-btn>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-endereco'">
                                                    <q-card>

                                                        <q-card-section>



                                                            <el-row :gutter="20">


                                                                <el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
                                                                    <div><p>CEP</p><span></span></div>
                                                                    <el-input v-model="cep.numero" placeholder="" ref="postalCode" v-maska data-maska="#####-###" @keyup="()=>{  if(cep.numero.length>=9){BuscarEndereco(item);} }">
                                                                        <template #append>
                                                                            <c-loading size="20px" v-if="carregandoCEP"></c-loading>
                                                                            <i class="fa fa-search" v-else-if="(cep.numero.length < 9)" style="color:var(--s-accent-color)" @click="$tools.Alert('Preencha todo o CEP para poder realizar a busca.')"></i>
                                                                            <i class="fa fa-search" v-else style="color:var(--s-accent-color);cursor:pointer" @click="BuscarEndereco"></i>
                                                                        </template>
                                                                    </el-input>
                                                                </el-col>



                                                                <el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
                                                                    <div><p>ESTADO</p><span></span></div>
                                                                    <div style="height:40px" v-if="carregandoEstados">
                                                                        <c-loading size="30px" style="padding-left:5px"></c-loading>
                                                                    </div>
                                                                    <el-select v-else filterable v-model="item.estado" class="m-4" placeholder="Selecionar" size="large" style="width:100%" @change="(iitem)=>{ObterCidades(iitem,item);enableFilterButton = true;}">
                                                                        <el-option v-for="iitem in opcoes.estados"
                                                                                   :key="iitem.id"
                                                                                   :label="iitem.label"
                                                                                   :value="iitem.uf"></el-option>
                                                                    </el-select>
                                                                </el-col>
                                                                <el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
                                                                    <div><p>CIDADE</p><span></span></div>
                                                                    <div style="height:40px" v-if="carregandoCidades">
                                                                        <c-loading size="30px" style="padding-left:5px"></c-loading>
                                                                    </div>
                                                                    <el-select v-else v-model="item.cidade" filterable class="m-4" placeholder="Selecionar" size="large" style="width:100%" @click="()=>{ if($validator.not(item.estado)){ $tools.Alert('Selecione um <b>Estado</b> antes');} }" @change="(item)=>{ObterBairros(iitem,item);enableFilterButton = true;}">
                                                                        <el-option v-for="iitem in opcoes.cidades"
                                                                                   :key="iitem.id"
                                                                                   :label="iitem.label"
                                                                                   :value="iitem.nome"></el-option>
                                                                    </el-select>
                                                                </el-col>
                                                                <el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
                                                                    <div><p>BAIRRO</p><span></span></div>
                                                                    <div style="height:40px" v-if="carregandoBairros">
                                                                        <c-loading size="30px" style="padding-left:5px"></c-loading>
                                                                    </div>
                                                                    <el-select v-else v-model="item.bairro" filterable :clearable="true" class="m-4" placeholder="Selecionar" size="large" style="width:100%;" @click="()=>{ if($validator.not(item.estado)){ $tools.Alert('Selecione <b>Estado</b> e <b>Cidade</b> antes');} }" @change="(item)=>{DefinirBairro(iitem,item);enableFilterButton = true;}">
                                                                        <el-option v-for="iitem in opcoes.bairros"
                                                                                   :key="iitem.id"
                                                                                   :label="iitem.label"
                                                                                   :value="iitem.nome"></el-option>
                                                                    </el-select>
                                                                </el-col>


                                                                <el-col :xs="24" :sm="12" :md="8" :lg="8" class="s-input">
                                                                    <div>LOGRADOURO <span>&nbsp;rua, avenida, praça, etc</span></div>
                                                                    <el-input @keyup.enter="Enviar()" v-model="item.logradouro" placeholder="" ref="logradouro" maxlength="80" input-style="text-transform:uppercase;"></el-input>
                                                                </el-col>
                                                                <el-col :xs="24" :sm="6" :md="4" :lg="4" class="s-input">
                                                                    <div>NÚMERO <span><b>SN</b> se não houver</span></div>
                                                                    <el-input @keyup.enter="Enviar()" v-model="item.numero" placeholder="" maxlength="80" input-style="text-transform:uppercase;" :ref="'endereconumero'+item.id"></el-input>
                                                                </el-col>

                                                                <el-col :xs="24" :sm="6" :md="4" :lg="4" class="s-input">
                                                                    <div>COMPLEMENTO <span>&nbsp;&nbsp;opcional</span></div>
                                                                    <el-input @keyup.enter="Enviar()" v-model="item.complemento" placeholder="" maxlength="80" input-style="text-transform:uppercase;"></el-input>
                                                                </el-col>

                                                            </el-row>

                                                            <div> <el-checkbox v-model="item.validadoEndereco" label="endereço válido"></el-checkbox></div>

                                                        </q-card-section>
                                                    </q-card>
                                                </div>
                                            </div>




                                            <div style="margin-top:10px;font-weight:500;color:#000">
                                                <el-input placeholder="" :value="ObterDataVisita(item)">
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:660;width:110px;text-align:right;cursor:pointer" @click="$tools.OpenCalendar(item.dataVisita)">
                                                            Visita   <i style="padding-left:10px" class="fa fa-calendar" title="visita agendada"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <q-btn icon="fa fa-copy" flat @click="()=>{ item.dataVisita.getFullYear() > 1900? $tools.Copy(item.dataVisita.format('dd/mm/yyyy, ddd, HH:MM\'h\'')) : $tools.MessageAlert('Data não especificada'); }" style="width:10px"></q-btn>
                                                        <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenCalendar(item.dataVisita)"></q-btn>
                                                        <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" @click="AbrirEdicaoAgenda(item)" v-if="item.acao != 'abrir-agenda'"></q-btn>
                                                        <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" @click="item.acao='fechar'" v-else></q-btn>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-agenda'">

                                                    <el-time-picker v-model="agenda.hora" placeholder="horário" size="large" @change="FormatarDataVisita(item)" style="max-width:140px"></el-time-picker>
                                                    <span style="padding-left:30px;">
                                                        <span v-if="item.dataVisita.getFullYear() > 1900" style="color:var(--s-color-primary);font-weight:700">{{item.dataVisita.format("dd/mm/yyyy, ddd, HH:MM'h'")}}</span><span v-else>sem agendamento</span>
                                                    </span>
                                                    <br />
                                                    <q-date v-model="agenda.data" style="max-width:720px" minimal @click="FormatarDataVisita(item)" :options="(date)=>{ return date >= new Date().format('yyyy/mm/dd'); }"></q-date>

                                                </div>
                                            </div>



                                            <div style="margin-top:10px;font-weight:500;color:#000">
                                                <el-input placeholder="" :value="item.descricao">
                                                    <template #prepend>
                                                        <div style="text-transform:uppercase;font-weight:700;width:110px;text-align:right;cursor:pointer" @click="()=>{item.acao=='abrir-descricao'?  item.acao='fechar-descricao' :  item.acao='abrir-descricao';}">
                                                            Descrição <i style="padding-left:10px" class="fa fa-message"></i>
                                                        </div>
                                                    </template>
                                                    <template #append>
                                                        <div @click="()=>{item.acao=='abrir-descricao'?  item.acao='fechar-descricao' :  item.acao='abrir-descricao';}" style="cursor:pointer;text-align:center">
                                                            <q-btn icon="fa fa-caret-down" flat style="margin-left:5px;width:10px" v-if="item.acao != 'abrir-descricao'"></q-btn>
                                                            <q-btn icon="fa fa-caret-up" flat style="margin-left:5px;width:10px" v-else></q-btn>
                                                        </div>
                                                    </template>
                                                </el-input>
                                                <div v-if="item.acao=='abrir-descricao'">
                                                    <el-input v-model="item.descricao" placeholder="" type="textarea" readonly :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
                                                </div>
                                            </div>


                                            <div>
                                                <div style="color:var(--s-color-primary);font-weight:bold;font-size:11px">
                                                    <div style="float:left;padding-top:5px">AVALIAR</div> 
                                                </div>
                                                <el-input v-model="item.avaliacao" placeholder="" type="textarea" :autosize="{ minRows: 3, maxRows: 5 }" :ref="'avaliacao'+item.id" style="font-size:12pt"></el-input>
                                            </div>
                                            <div style="margin-top:10px;width:100%;text-align:center">
                                                <q-btn label="AGUARDAR" color="orange" text-color="white" @click="Cancelar(item)" :loading="item.acao=='cancelar'" style="width:160px;margin-left:00px"></q-btn>
                                                <q-btn label="SALVAR" color="primary" text-color="white" @click="Alterar(item)" :loading="item.acao=='alterar'" style="width:160px;margin-left:20px"></q-btn>
                                                <q-btn label="FINALIZAR" color="teal" text-color="white" @click="Finalizar(item)" :loading="item.acao=='finalizar'" style="width:160px;margin-left:20px"></q-btn>
                                            </div>


                                        </div>

                                    </q-card-section>
                                </q-card>





                            </el-col>


</div>
                </q-tab-panel>







                <q-tab-panel name="finalizadas">
                    <div>

                        <el-row :gutter="20">

                            <el-col :md="24" style="width:100%;text-align:center;padding:40px;padding-left:0px" v-if="totalFinalizadas == 0">
                                <i class="fa fa-circle-exclamation" style="font-size:80px;color:var(--s-color-primary)"></i>  <br />
                                <div style="font-size:20px;font-weight:700;color:var(--s-color-primary);margin-top:20px">Sem solicitações finalizadas.</div>
                            </el-col>

                            <div v-if="totalFinalizadas > 0" style="color:var(--s-color-primary);font-weight:700;height:40px;padding-left:12px">{{totalFinalizadas}} <span v-if="totalFinalizadas == 1">solicitação</span><span v-else>solicitações</span></div>

                            <el-col v-if="totalFinalizadas > 0" :md="24" v-for="(item,index) in resultsFinalizadas" style="padding:10px">




                                <c-card v-if="item.ativo" :idStatus="item.idStatus" :title2="item.idStatus == 3? 'AGUARDANDO CAPTADOR' : item.idStatus == 5? 'EM VERIFICAÇÃO' : 'FINALIZADA' " :title="'<b style=\'margin-right:10px;\'>#ID '+item.id+'</b>'+$tools.FormatDateHourToBR(item.data)+', '+$tools.GetFullDayWeek(item.data)">
                                    <div style="display:flow-root">
                                        <div style="font-weight:700;display:inline-block;float:left;line-height:28px">
                                            <span style="color:#000;font-weight:normal">
                                                <i class="icons fa fa-user" style="margin-right:3px;"></i>{{item.parceiro.nome}}
                                                <br />
                                                <span style="margin-right:10px">#id {{item.parceiro.id}}</span>
                                                <a :href="$tools.BuildWhatsappLink(item.parceiro.telefone,'Olá '+item.apelido)" target="_blank" style="margin-left:00px;color:var(--s-color-green);text-decoration:none"><i class="fab fa-whatsapp" style="padding-right:3px;"></i> {{item.parceiro.telefone}}</a>
                                                <a v-if="$validator.IsCPF(item.parceiro.cpf)" href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cpf)" style="margin-left:20px;text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="padding-right:3px;text-decoration:none"></i>CPF: {{item.parceiro.cpf}}  </a>
                                                <a v-else-if="$validator.IsCNPJ(item.parceiro.cnpj)" href="javascript:void(0)" @click="$tools.Copy(item.parceiro.cnpj)" style="margin-left:20px;text-decoration:none;color:var(--s-color-tex-alt)"><i class="fa fa-copy" style="padding-right:3px;text-decoration:none"></i>CNPJ: {{item.parceiro.cnpj}}  </a>
                                                <a :href="'mailto:'+item.parceiro.email" target="_blank" style="margin-left:20px;color:var(--el-color-primary);text-decoration:none"><i class="fa fa-envelope"></i>&nbsp; {{item.parceiro.email}}</a>
                                            </span>

                                            <!--<br />
                    <span style="cursor:pointer;font-weight:normal" @click="$tools.OpenMap(item)">
                        <i class="icons fa fa-map-marker-alt" style="margin-right:10px"></i>
                        {{$tools.BuildAddress(item)}}
                        <i class="fa fa-up-right-from-square" style="padding-left:20px;font-size:14px;color:#000"></i>
                    </span>-->
                                        </div>
                                    </div>

                                    <div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
                                        <el-input v-model="item.url" readonly input-style="text-transform:lowercase;">
                                            <template #prepend>
                                                <div style="text-transform:uppercase;font-weight:700;width:10px" @click="$tools.OpenLink(item.url)">
                                                    <i class="fa fa-link"></i>
                                                </div>
                                            </template>
                                            <template #append>
                                                <q-btn icon="fa fa-copy" flat @click="$tools.CopyLink(item.url)" style="width:10px" :title="item.url"></q-btn>
                                                <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenLink(item.url)"></q-btn>
                                                <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" @click="item.acao=2" v-if="item.acao != 2"></q-btn>
                                                <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" @click="item.acao=0" v-else></q-btn>
                                            </template>
                                        </el-input>
                                        <div v-if="item.acao==2">
                                            <q-card>
                                                <q-card-section>
                                                    <el-input v-model="item.url" placeholder="" type="textarea" :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
                                                </q-card-section>
                                            </q-card>
                                        </div>
                                    </div>


                                    <div style="margin-top:10px;font-weight:500;cursor:pointer;color:#000">
                                        <el-input placeholder="" :value="$tools.BuildAddress(item)" readonly>
                                            <template #prepend>
                                                <div style="text-transform:uppercase;font-weight:700;width:10px" @click="$tools.OpenLink(item.url)">
                                                    <i class="fa fa-map-marker-alt"></i>
                                                </div>
                                            </template>
                                            <template #append>
                                                <q-btn icon="fa fa-copy" flat @click="$tools.Copy($tools.BuildAddress(item))" style="width:10px"></q-btn>
                                                <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenMap(item)"></q-btn>
                                                <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" @click="AbrirEdicaoEndereco(item)" v-if="item.acao != 3"></q-btn>
                                                <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" @click="item.acao=''" v-else></q-btn>
                                            </template>
                                        </el-input>
                                    </div>
                                    <div style="margin-top:10px;font-weight:500;color:#000">
                                        <el-input placeholder="" :value="ObterDataVisita(item)">
                                            <template #prepend>
                                                <div style="text-transform:uppercase;font-weight:700;width:10px" title="visita agendada">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                            </template>
                                            <template #append>
                                                <q-btn icon="fa fa-copy" flat @click="()=>{ item.dataVisita.getFullYear() > 1900? $tools.Copy(item.dataVisita.format('dd/mm/yyyy, ddd, HH:MM\'h\'')) : $tools.MessageAlert('Data não especificada'); }" style="width:10px"></q-btn>
                                                <q-btn icon="fa fa-up-right-from-square" flat style="margin-left:5px;width:10px" @click="$tools.OpenCalendar(item.dataVisita)"></q-btn>
                                                <q-btn icon="fa fa-edit" flat style="margin-left:5px;width:10px" @click="AbrirEdicaoAgenda(item)" v-if="item.acao != 4"></q-btn>
                                                <q-btn icon="fa fa-close" flat style="margin-left:5px;width:10px" @click="item.acao=''" v-else></q-btn>
                                            </template>
                                        </el-input>
                                    </div>
                                    <div>
                                        <div style="color:var(--s-color-primary);font-weight:bold;font-size:11px">
                                            <div style="float:left;padding-top:5px">DESCRIÇÃO</div>
                                        </div>
                                        <el-input v-model="item.descricao" placeholder="" type="textarea" readonly :autosize="{ minRows: 2, maxRows: 4 }" style="font-size:12pt"></el-input>
                                    </div>
                                    <div>
                                        <div style="color:var(--s-color-primary);font-weight:bold;font-size:11px">
                                            <div style="float:left;padding-top:5px">AVALIAÇÃO</div>  <div style="float:right"> <el-checkbox v-model="item.liberado" label="permitir cliente ver avaliação antes de finalizar"></el-checkbox></div>
                                        </div>
                                        <el-input v-model="item.avaliacao" placeholder="" type="textarea" :autosize="{ minRows: 3, maxRows: 5 }" :ref="'avaliacao'+item.id" style="font-size:12pt"></el-input>
                                    </div>
                                    <div style="margin-top:10px;width:100%;text-align:center">
                                        <q-btn label="REAVALIAR" color="teal" text-color="white" @click="Reavaliar(item)" :loading="item.acao=='reavaliar'" style="width:160px;margin-left:00px"></q-btn>
                                        <!--<q-btn label="EXCLUIR"      color="green" text-color="white" @click="Excluir(item)"   style="width:160px;margin-left:20px"></q-btn>-->
                                    </div>
                                </c-card>










                            </el-col>


</div>
                </q-tab-panel>






            </q-tab-panels>
        </div>
    </div>
</template>



<script>
    module.exports = {
        components: {
            page_relatorio: LoadComponent("./pages/solicitacao/Relatorio.htm")
        },

        data: function () {
            return {
                tab: "relatorio",
                view: "request",
                messageSuccess: "",
                messageAlert: "",
                content: "",
                
                carregandoCEP: false,
                carregandoEstados: false,
                carregandoCidades: false,
                carregandoBairros: false,
                cep: {
                    numero: "",
                    estado: "",
                    cidade: "",
                    logradouro: ""
                },
                opcoes: {
                    estados: this.$root.localidade.estados,
                    cidades: [],
                    bairros: [],
                    sexos: [],
                },
              
                solicitacao: this.$models.solicitacao(),
                results: [],
                resultsAguardando: [],
                resultsVerificando: [],
                resultsFinalizadas: [],
                totalAguardando: 0,
                totalVerificando: 0,
                totalFinalizadas: 0,
                cards: [],
                city: "",
                dataVisitalabel: "sem agenda",
                idAdminSelecionado: 'Todos',
                agenda: { data: new Date(1900, 1, 0, 0, 0, 0, 0), hora: null, obs: "" },
                dateStart: new Date()

            }
        }, computed: {

        },

        props: {},
        watch: {
        },
        created: function () {
        },
        mounted() {
            this.Enviar();
        },
        methods: {



            ShowView(v) {
                this.view = v;
            },


            GetDateHourLabel(item) {
                var hoje = new Date();
                var dataItem = new Date(item.data);
                var label = "";
                var dias = Math.ceil(Math.abs(hoje - dataItem) / (1000 * 60 * 60 * 24));
                var diffHours = Math.ceil(Math.abs(hoje - dataItem) / (1000 * 60 * 60)); 
                var label = "";
                
                if(dias==0)
                    label = "<b>Hoje às " + dataItem.getHours() + ':' + dataItem.getMinutes() + "h</b> ( há " + diffHours + "h)";
                else
                    label = "Há " + dias + " dias";
                //label += dataItem.getHours() + ':' + dataItem.getMinutes() + " há " + diffHours + "h";
                return label;
            },

            AbrirEdicaoEndereco(item) {
                this.cep.numero = item.cep;
                item.acao = 'abrir-endereco';
            },

            AbrirEdicaoAgenda(item) {
                var dt = this.agenda.data = this.agenda.hora = new Date(item.dataVisita);
                dt.setHours((this.agenda.hora.getHours()), this.agenda.hora.getMinutes(),0,0);
                this.agenda.hora.setHours(dt.getHours(), dt.getMinutes(), 0, 0);
                this.agenda.data.setHours(dt.getHours(), dt.getMinutes(), 0, 0);
                item.acao = 'abrir-agenda';
            },

            UpdateProprietarioCaptacao(item) {
                item.proprietarioCaptacao = item.proprietario.nome + "," + item.proprietario.telefone + "," + item.proprietario.email;
            },

            ObterDataVisita(item) {
                if (this.$validator.is(item.dataVisita)) {
                    var data = item.dataVisita;
                    //return data.format("dd/mm/yyyy, ddd, HH:MM'h'");
                    return (data.getFullYear() > 1900) ? data.format("dd/mm/yyyy, ddd, HH:MM'h'") : "sem visita agendada"; 
                 }
                return "";
            },

            async Enviar() {

                this.view = "request";

                var request = await this.$api.Get("solicitacao/obter/todos/admin");

                if (request?.status?.success) {
                    this.view = "success";
                    this.results = request.result;

                    this.results.forEach(i => {
                        i.dataVisita    = new Date(i.dataVisita);
                        i.acaocard      = 'fechar-card' + i.id;
                       // i.proprietarioCaptacao = "Teste, (11) 98498-4894, paulogneto@gmail.com";
                        if (this.$validator.is(i.proprietarioCaptacao)) {
                            var fields = i.proprietarioCaptacao.split(",");
                            i.proprietario.nome     = this.$validator.is(fields[0])? fields[0] : "";
                            i.proprietario.telefone = this.$validator.is(fields[1])? fields[1] : "";
                            i.proprietario.email    = this.$validator.is(fields[2])? fields[2] : "";
                        }
                    });

                    this.resultsAguardando  = this.results.filter(r => r.idStatus == 3);
                    this.resultsVerificando = this.results.filter(r => r.idStatus == 5);
                    this.resultsFinalizadas = this.results.filter(r => r.idStatus == 9);

                    this.totalAguardando    = this.resultsAguardando.length;
                    this.totalVerificando   = this.resultsVerificando.length;
                    this.totalFinalizadas   = this.resultsFinalizadas.length;

                    //c(this.results[0]);

                }//else
                //  this.view = "fail";




            },

            FiltrarAguardando(idAdmin) {
                this.resultsAguardando = (idAdmin > 0) ? this.results.filter(r => r.idStatus == 3 && r.ativo && r.idAdmin == idAdmin) : this.results.filter(r => r.idStatus == 3 && r.ativo);
                this.totalAguardando    = this.resultsAguardando.length;
            },
            FiltrarVerificando(idAdmin) {
                this.resultsVerificando = (idAdmin > 0) ? this.results.filter(r => r.idStatus == 5 && r.ativo && r.idAdmin == idAdmin) : this.results.filter(r => r.idStatus == 5 && r.ativo);
                this.totalVerificando = this.resultsAguardando.length;
            },
            FiltrarFinalizadas(idAdmin) {
                this.resultsFinalizadas = (idAdmin > 0) ? this.results.filter(r => r.idStatus == 9 && r.ativo && r.idAdmin == idAdmin) : this.results.filter(r => r.idStatus == 9 && r.ativo);
                this.totalFinalizadas = this.resultsFinalizadas.length;
            },
    

            async Captar(item) {
                item.acao = 'captar';
                var request = await this.$api.Post("solicitacao/captar", item);
                if (request?.status?.success) {
                    item.acao = 0;
                    //this.$tools.AlertSuccess("Solicitação ID# " + item.id + " captada em verificação!");
                    this.$tools.MessageSuccess("Solicitação ID# " + item.id + " captada em verificação!");
                    request.result.dataVisita = new Date(request.result.dataVisita);
                    request.result.acaocard = 'abrir-card' + request.result.id;
                    this.resultsVerificando.unshift(request.result);
                    this.totalAguardando--;
                    this.totalVerificando++;
                    item.ativo = false;
                    this.tab = "verificando";
                    this.$tools.Top();
                    window.setTimeout(() => this.$refs["avaliacao"+item.id].focus(), 500);
                    //c(this.results);
                }//else
                 //  this.view = "fail";
            },
    
            async Reavaliar(item) {
                item.acao = 'reavaliar';
                var request = await this.$api.Post("solicitacao/captar", item);
                if (request?.status?.success) {
                    item.acao = 0;
                    //this.$tools.AlertSuccess("Solicitação ID# " + item.id + " captada em verificação!");
                    this.$tools.MessageSuccess("Solicitação ID# " + item.id + " captada em verificação!");
                    request.result.dataVisita = new Date(request.result.dataVisita);
                    request.result.acaocard = 'abrir-card' + request.result.id;
                    this.resultsVerificando.unshift(request.result);
                    this.totalFinalizadas--;
                    this.totalVerificando++;
                    item.ativo = false;
                    this.tab = "verificando";
                    this.$tools.Top();
                    window.setTimeout(() => this.$refs["avaliacao"+item.id].focus(), 500);
                    //c(this.results);
                }//else
                 //  this.view = "fail";
            },

            async Cancelar(item) {
                item.acao = 'cancelar';
                var request = await this.$api.Post("solicitacao/cancelar", item);
                if (request?.status?.success) {
                    item.acao = request.result.acao = 0;
                    this.$tools.AlertSuccess("Solicitação ID# " + item.id + " voltou para o status de aguardada.");
                    request.result.dataVisita = new Date(request.result.dataVisita);
                    this.resultsAguardando.unshift(request.result);
                    this.totalVerificando--;
                    this.totalAguardando++;
                    //this.resultsVerificando = this.results.filter(r => r.id != item.id && r.idStatus == 5);
                    //this.resultsFinalizadas = this.results.filter(r => r.id != item.id && r.idStatus == 9);
                    item.ativo = false;
                    //c(this.results);
                }//else
                 //  this.view = "fail";
            },

            async Alterar(item) {
                item.acao = 'alterar';
                var request = await this.$api.Post("solicitacao/alterar", item);
                item.acao = 0;
                if (request?.status?.success) {
                    item = request.result;
                    item.dataVisita = new Date(item.dataVisita);
                    item.acao = 0;
                    this.$tools.AlertSuccess("Solicitação ID# " + item.id +" salva!");
                    //c(this.results);
                }//else
                 //  this.view = "fail";
            },

            
            async Finalizar(item) {
                item.acao = 'finalizar';
                var request = await this.$api.Post("solicitacao/finalizar", item);
                if (request?.status?.success) {
                    item.acao = 0;
                    this.$tools.AlertSuccess("Solicitação ID# "+item.id+" finalizada!");
                    request.result.dataVisita = new Date(request.result.dataVisita);
                    this.resultsFinalizadas.unshift(request.result);
                    this.totalVerificando--;
                    this.totalFinalizadas++;
                    item.ativo = false;
                    //c(this.results);
                }//else
                 //  this.view = "fail";
            },



            async BuscarEndereco(item) {

                if (this.cep.numero !== item.cep) {

                    this.carregandoCEP = true;
                    this.carregandoEstados = true;
                    this.carregandoCidades = true;
                    this.carregandoBairros = true;

                    this.cep.cidade     = item.cidade       = "";
                    this.cep.logradouro = item.logradouro   = "";
                    this.cep.bairro     = item.bairro       = "";
                    this.cep.estado     = item.estado       = "";

                    item.cep = this.cep.numero;
                    let res = await this.$sdata.BuscarEndereco(this.cep.numero);

                    if (this.$validator.is(res?.city)) {
                        this.cep.cidade     = item.cidade       = res.city;
                        this.cep.logradouro = item.logradouro   = res.address;
                        this.cep.bairro     = item.bairro       = res.neighborhood;
                        this.cep.estado     = item.estado       = res.state;
                    }

                    this.carregandoCEP = false;
                    this.carregandoEstados = false;
                    this.carregandoCidades = false;
                    this.carregandoBairros = false;

                    this.$refs["endereconumero" + item.id].focus();
                }
            },

            async BuscarCep(item) {
                var endereco = item.estado + "/" + item.cidade.replaceAll(" ", "%20") + "/" + item.logradouro.replaceAll(" ", "%20")
                let res = await this.$sdata.BuscarCep(endereco);
                return res.cep;
            },



            ObterCidades(estado,item) {

                item.cidade     = item.bairro = "";
                item.idCidade   = item.idBairro = 0;

                this.opcoes.bairros = [];
                this.opcoes.cidades = [];
                var cidades = [];

                if (this.$validator.is(estado)) {
                    this.carregandoCidades = true;
                    item.idEstado = this.opcoes.estados.filter((e) => e.uf == estado)[0].id;
                    this.$sdata.ObterCidades(item.idEstado).then(res => { this.carregandoCidades = false; this.opcoes.cidades = res; });
                }

            },


            ObterBairros(cidade,item) {

                item.bairro = "";
                item.idBairro = 0;

                this.opcoes.bairros = [];
                var bairros = [];

                if (this.$validator.is(cidade)) {
                    this.carregandoBairros = true;
                    item.idCidade = this.opcoes.cidades.filter((c) => c.nome == cidade)[0].id;
                    this.$sdata.ObterBairros(item.idCidade).then(res => { this.carregandoBairros = false; this.opcoes.bairros = res; });
                }

            },

            DefinirBairro(bairro,item) {
                item.idBairro = this.opcoes.bairros.filter((c) => c.nome == bairro)[0].id;
                //this.$refs.logradouro.focus();
                //this.solicitacao.bairro = bairro.label;
                //c2("this.solicitacao", this.solicitacao);
            },





            FormatarDataVisita(item) {

                var dia = null;
                var hora = null;

                if (this.$validator.is(this.agenda.data)) {
                    dia = new Date(this.agenda.data);
                    item.dataVisita = new Date(dia.toUTCString());

                    if (this.$validator.not(this.agenda.hora))
                        this.agenda.hora = new Date(1900, 0, 1, 16, 0, 0, 0);

                    hora = new Date(this.agenda.hora);
                    dia.setHours((hora.getHours()), hora.getMinutes(), 0, 0);
                    //this.dataVisitaLabel = dia.format("dd/mm/yyyy, HH:MM'h'");

                } else {
                    item.dataVisita = new Date(1900, 0, 1, 0, 0, 0, 0);
                    //this.dataVisitaLabel = "";
                    this.agenda.hora = null;
                }


                if (this.$validator.is(this.agenda.hora)) {

                    hora = new Date(this.agenda.hora);
                    item.dataVisita.setHours(hora.getHours(), hora.getMinutes(), 0, 0);
                    //item.dataVisita.setHours((hora.getHours() - 3), hora.getMinutes(), 0, 0);

                    dia.setHours((hora.getHours()), hora.getMinutes(), 0, 0);
                    //this.dataVisitaLabel = dia.format("dd/mm/yyyy, ddd, HH:MM'h'");
                }


            },






        }

    }

</script>


<style scoped>
    .s-input {
        margin-bottom: 20px;
    }
</style>


